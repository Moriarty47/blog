<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <link rel="icon" href="/blog/images/m.ico"><link rel="stylesheet" media="print" href="/blog/print.css"><title>Webpack 源码分析 | LOFT</title><meta name="description" content="LOFT">
    <link rel="preload" href="/blog/assets/style-52786e27.css" as="style"><link rel="stylesheet" href="/blog/assets/style-52786e27.css">
    <link rel="modulepreload" href="/blog/assets/app-bf7bc9cc.js"><link rel="modulepreload" href="/blog/assets/framework-5411b43d.js"><link rel="modulepreload" href="/blog/assets/sourcecode.html-5e4272b7.js"><link rel="modulepreload" href="/blog/assets/sourcecode.html-d56c3ff3.js"><link rel="prefetch" href="/blog/assets/index.html-ae2f7e7a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-09607301.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0629a64a.js" as="script"><link rel="prefetch" href="/blog/assets/QA.html-df081e4e.js" as="script"><link rel="prefetch" href="/blog/assets/githubproxy.html-383ad34a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9dbcffc4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-72366d4d.js" as="script"><link rel="prefetch" href="/blog/assets/advance.html-bd76e31a.js" as="script"><link rel="prefetch" href="/blog/assets/compress.html-19f867fc.js" as="script"><link rel="prefetch" href="/blog/assets/concept.html-5d747e0d.js" as="script"><link rel="prefetch" href="/blog/assets/fingerprint.html-74df5d80.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-caac1a24.js" as="script"><link rel="prefetch" href="/blog/assets/miniWebpack.html-640bc47e.js" as="script"><link rel="prefetch" href="/blog/assets/mpa.html-dc91e647.js" as="script"><link rel="prefetch" href="/blog/assets/package.html-c27afd58.js" as="script"><link rel="prefetch" href="/blog/assets/perfermance.html-2783f9cc.js" as="script"><link rel="prefetch" href="/blog/assets/resolve.html-b0ca34d9.js" as="script"><link rel="prefetch" href="/blog/assets/ssr.html-d18e6a7e.js" as="script"><link rel="prefetch" href="/blog/assets/watch.html-91a1440b.js" as="script"><link rel="prefetch" href="/blog/assets/ES10.html-b9a36ee0.js" as="script"><link rel="prefetch" href="/blog/assets/ES11.html-4b772d99.js" as="script"><link rel="prefetch" href="/blog/assets/ES12.html-b273fef0.js" as="script"><link rel="prefetch" href="/blog/assets/ES13.html-a4694136.js" as="script"><link rel="prefetch" href="/blog/assets/ES7.html-b1fd333a.js" as="script"><link rel="prefetch" href="/blog/assets/ES8.html-70de0ef1.js" as="script"><link rel="prefetch" href="/blog/assets/ES9.html-ad995181.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b3c200c4.js" as="script"><link rel="prefetch" href="/blog/assets/gc.html-879bbaaa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8c49129c.js" as="script"><link rel="prefetch" href="/blog/assets/mathematicalNotation.html-280346a4.js" as="script"><link rel="prefetch" href="/blog/assets/this.html-be64c28d.js" as="script"><link rel="prefetch" href="/blog/assets/1-two-sum.html-f3a55376.js" as="script"><link rel="prefetch" href="/blog/assets/14-longest-common-prefix.html-465081db.js" as="script"><link rel="prefetch" href="/blog/assets/15-3sum.html-7e96aef9.js" as="script"><link rel="prefetch" href="/blog/assets/18-4sum.html-f5377a98.js" as="script"><link rel="prefetch" href="/blog/assets/6-zigzag-conversion.html-02434e20.js" as="script"><link rel="prefetch" href="/blog/assets/array.html-1f7213e1.js" as="script"><link rel="prefetch" href="/blog/assets/class.html-5c53e6c7.js" as="script"><link rel="prefetch" href="/blog/assets/destructuring.html-3d95d00d.js" as="script"><link rel="prefetch" href="/blog/assets/function.html-5b1890fd.js" as="script"><link rel="prefetch" href="/blog/assets/let-const.html-f4c74b49.js" as="script"><link rel="prefetch" href="/blog/assets/module.html-2eb7c0e9.js" as="script"><link rel="prefetch" href="/blog/assets/object.html-1e8d1a47.js" as="script"><link rel="prefetch" href="/blog/assets/promise.html-b0d01336.js" as="script"><link rel="prefetch" href="/blog/assets/proxy.html-6cce4ed5.js" as="script"><link rel="prefetch" href="/blog/assets/reflect.html-d0dee0d2.js" as="script"><link rel="prefetch" href="/blog/assets/string.html-a33f1c81.js" as="script"><link rel="prefetch" href="/blog/assets/symbol.html-d3d9d977.js" as="script"><link rel="prefetch" href="/blog/assets/architecture.html-bb003c77.js" as="script"><link rel="prefetch" href="/blog/assets/concept.html-19390284.js" as="script"><link rel="prefetch" href="/blog/assets/implementation.html-f677d051.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-37c96fc2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2c7734b5.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2a7064dc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-472548ee.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bbff9a7b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-537e5be5.js" as="script"><link rel="prefetch" href="/blog/assets/QA.html-a69c1aa2.js" as="script"><link rel="prefetch" href="/blog/assets/githubproxy.html-15702a66.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3397593f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e247f25c.js" as="script"><link rel="prefetch" href="/blog/assets/advance.html-ce0e3ae7.js" as="script"><link rel="prefetch" href="/blog/assets/compress.html-18eb6643.js" as="script"><link rel="prefetch" href="/blog/assets/concept.html-c25f52f1.js" as="script"><link rel="prefetch" href="/blog/assets/fingerprint.html-2d7c877c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f3398cb3.js" as="script"><link rel="prefetch" href="/blog/assets/miniWebpack.html-7b84d436.js" as="script"><link rel="prefetch" href="/blog/assets/mpa.html-eef62d46.js" as="script"><link rel="prefetch" href="/blog/assets/package.html-e2375368.js" as="script"><link rel="prefetch" href="/blog/assets/perfermance.html-c8dd4b3c.js" as="script"><link rel="prefetch" href="/blog/assets/resolve.html-088c6ba8.js" as="script"><link rel="prefetch" href="/blog/assets/ssr.html-f6260664.js" as="script"><link rel="prefetch" href="/blog/assets/watch.html-899fa7db.js" as="script"><link rel="prefetch" href="/blog/assets/ES10.html-7774aa09.js" as="script"><link rel="prefetch" href="/blog/assets/ES11.html-ba657adf.js" as="script"><link rel="prefetch" href="/blog/assets/ES12.html-891ac07a.js" as="script"><link rel="prefetch" href="/blog/assets/ES13.html-8baa9a07.js" as="script"><link rel="prefetch" href="/blog/assets/ES7.html-b39e40d3.js" as="script"><link rel="prefetch" href="/blog/assets/ES8.html-6543214d.js" as="script"><link rel="prefetch" href="/blog/assets/ES9.html-2379df8e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-79c64d37.js" as="script"><link rel="prefetch" href="/blog/assets/gc.html-92db9a5b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0d3d37f3.js" as="script"><link rel="prefetch" href="/blog/assets/mathematicalNotation.html-ac26ff78.js" as="script"><link rel="prefetch" href="/blog/assets/this.html-f3621cf1.js" as="script"><link rel="prefetch" href="/blog/assets/1-two-sum.html-3ff91204.js" as="script"><link rel="prefetch" href="/blog/assets/14-longest-common-prefix.html-073b04b3.js" as="script"><link rel="prefetch" href="/blog/assets/15-3sum.html-eb2e5c75.js" as="script"><link rel="prefetch" href="/blog/assets/18-4sum.html-946c996f.js" as="script"><link rel="prefetch" href="/blog/assets/6-zigzag-conversion.html-d320ed4d.js" as="script"><link rel="prefetch" href="/blog/assets/array.html-f54cd776.js" as="script"><link rel="prefetch" href="/blog/assets/class.html-b1d437e8.js" as="script"><link rel="prefetch" href="/blog/assets/destructuring.html-700158ce.js" as="script"><link rel="prefetch" href="/blog/assets/function.html-01981adc.js" as="script"><link rel="prefetch" href="/blog/assets/let-const.html-164e398b.js" as="script"><link rel="prefetch" href="/blog/assets/module.html-09065d86.js" as="script"><link rel="prefetch" href="/blog/assets/object.html-4e725ea9.js" as="script"><link rel="prefetch" href="/blog/assets/promise.html-ef7029a9.js" as="script"><link rel="prefetch" href="/blog/assets/proxy.html-69408401.js" as="script"><link rel="prefetch" href="/blog/assets/reflect.html-82e27965.js" as="script"><link rel="prefetch" href="/blog/assets/string.html-682b4bea.js" as="script"><link rel="prefetch" href="/blog/assets/symbol.html-1d32cc56.js" as="script"><link rel="prefetch" href="/blog/assets/architecture.html-9e3e39e0.js" as="script"><link rel="prefetch" href="/blog/assets/concept.html-c7b8ce71.js" as="script"><link rel="prefetch" href="/blog/assets/implementation.html-937cb1be.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0018c0ee.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b2423981.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-be216922.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-78eccbaa.js" as="script"><link rel="prefetch" href="/blog/assets/Playground-3eb19026.js" as="script"><link rel="prefetch" href="/blog/assets/index-e3112853.js" as="script"><link rel="prefetch" href="/blog/assets/CodeLink-dd177f41.js" as="script"><link rel="prefetch" href="/blog/assets/CodeTool-4b08e5c5.js" as="script"><link rel="prefetch" href="/blog/assets/index-4bed0a7c.js" as="script"><link rel="prefetch" href="/blog/assets/index-7d6bcf76.js" as="script"><link rel="prefetch" href="/blog/assets/index-37fe586b.js" as="script"><link rel="prefetch" href="/blog/assets/index-94db7077.js" as="script"><link rel="prefetch" href="/blog/assets/katex-21dcf7db.js" as="script"><link rel="prefetch" href="/blog/assets/mermaid.core-905ae0d6.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container page-indent"><!--[--><header class="navbar" style="visibility:unset;"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><!----><span class="site-name can-hide">LOFT</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="LOFT"><!--[--><!--]--> LOFT <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/playground" class="" aria-label="游乐场"><!--[--><!--]--> 游乐场 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="文章"><span class="title">文章</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="文章"><span class="title">文章</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/JSBooks/ECMAScript/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/Leetcode/Array/1-two-sum.md" class="" aria-label="Leetcode"><!--[--><!--]--> Leetcode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/Bundler/" class="router-link-active" aria-label="构建工具"><!--[--><!--]--> 构建工具 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/Tutorial/" class="" aria-label="解决方案及教程"><!--[--><!--]--> 解决方案及教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="更多"><span class="title">更多</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="更多"><span class="title">更多</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/resume" class="" aria-label="简历"><!--[--><!--]--> 简历 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="切换颜色"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="LOFT"><!--[--><!--]--> LOFT <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/playground" class="" aria-label="游乐场"><!--[--><!--]--> 游乐场 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="文章"><span class="title">文章</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="文章"><span class="title">文章</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/JSBooks/ECMAScript/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/Leetcode/Array/1-two-sum.md" class="" aria-label="Leetcode"><!--[--><!--]--> Leetcode <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/Bundler/" class="router-link-active" aria-label="构建工具"><!--[--><!--]--> 构建工具 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/Tutorial/" class="" aria-label="解决方案及教程"><!--[--><!--]--> 解决方案及教程 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="更多"><span class="title">更多</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="更多"><span class="title">更多</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/resume" class="" aria-label="简历"><!--[--><!--]--> 简历 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">构建工具 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/Bundler/index.md" class="sidebar-item" aria-label="WHY"><!--[--><!--]--> WHY <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item active">Webpack <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/Bundler/Webpack/index.md" class="sidebar-item" aria-label="概况"><!--[--><!--]--> 概况 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/concept.md" class="sidebar-item" aria-label="核心概念"><!--[--><!--]--> 核心概念 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/resolve.md" class="sidebar-item" aria-label="资源解析"><!--[--><!--]--> 资源解析 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/watch.md" class="sidebar-item" aria-label="文件监听与热更新"><!--[--><!--]--> 文件监听与热更新 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/fingerprint.md" class="sidebar-item" aria-label="文件指纹"><!--[--><!--]--> 文件指纹 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/compress.md" class="sidebar-item" aria-label="代码压缩"><!--[--><!--]--> 代码压缩 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/mpa.md" class="sidebar-item" aria-label="多页面应用"><!--[--><!--]--> 多页面应用 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/ssr.md" class="sidebar-item" aria-label="服务端渲染(SSR)"><!--[--><!--]--> 服务端渲染(SSR) <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/advance.md" class="sidebar-item" aria-label="进阶用法"><!--[--><!--]--> 进阶用法 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/perfermance.md" class="sidebar-item" aria-label="构建优化"><!--[--><!--]--> 构建优化 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/package.md" class="sidebar-item" aria-label="编写可维护的Webpack构建配置"><!--[--><!--]--> 编写可维护的Webpack构建配置 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/sourcecode.md" class="sidebar-item active" aria-label="源码分析"><!--[--><!--]--> 源码分析 <!--[--><!--]--></a><!----></li><li><a href="/blog/Bundler/Webpack/miniWebpack.md" class="sidebar-item" aria-label="实现Webpack"><!--[--><!--]--> 实现Webpack <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><!----><!--[--><!-- name="fade-slide-y" --><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><!--[--><div><h2 id="webpack-源码分析" tabindex="-1"><a class="header-anchor" href="#webpack-源码分析" aria-hidden="true">#</a> Webpack 源码分析</h2><p>可将其理解为一种基于事件流的编程范例，一系列的插件运行。</p><h3 id="webpack-命令" tabindex="-1"><a class="header-anchor" href="#webpack-命令" aria-hidden="true">#</a> <code>webpack</code> 命令</h3><ul><li>通过 npm scripts 运行 webpack</li></ul><p><code>npm run dev</code> <code>npm run build</code></p><ul><li>通过 webpack 直接运行</li></ul><p><code>webpack entry.js bundle.js</code></p><p>命令行运行以上命令后，npm 会 让命令行工具进入 <code>node_modules\.bin</code> 目录 查找是否存在 <code>webpack.sh</code> 或者 <code>webpack.cmd</code> 或者 <code>webpack.ps1</code> 文件，如果存在，就执行，不存在，抛出错误。</p><p>实际入口文件是 <code>node_modules\webpack\bin\webpack.js</code></p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token comment">// 1. 正常执行返回</span>
process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 运行某个命令</span>
<span class="token keyword">const</span> <span class="token function-variable function">runCommand</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 3. 判断某个包是否安装</span>
<span class="token keyword">const</span> isInstalled <span class="token operator">=</span> packageName <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 4. webpack可用的CLI：webpack-cli和webpack-command</span>
<span class="token keyword">const</span> CLIs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 5. 过滤安装过的CLI</span>
<span class="token keyword">const</span> installedClis <span class="token operator">=</span> CLIs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">cli</span> <span class="token operator">=&gt;</span> cli<span class="token punctuation">.</span>installed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 6. 根据安装数量进行处理</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>installedClis<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>installedClis<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 7. 中途报错退出</span>
process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div><p><code>webpack</code> 最终找到 <code>webpack-cli</code> / <code>webpack-command</code> 包，并执行 CLI。</p><h3 id="webpack-cli-命令" tabindex="-1"><a class="header-anchor" href="#webpack-cli-命令" aria-hidden="true">#</a> <code>webpack-cli</code> 命令</h3><ul><li>引入 yargs，对命令行进行定制</li><li>分析命令行参数，对各个参数进行转换，组成编译配置项</li><li>引入 webpack，根据配置项进行编译和构建</li></ul><h4 id="从-non-compilation-cmd-分析出不需要编译的命令" tabindex="-1"><a class="header-anchor" href="#从-non-compilation-cmd-分析出不需要编译的命令" aria-hidden="true">#</a> 从 NON_COMPILATION_CMD 分析出不需要编译的命令</h4><p>webpack-cli 处理不需要经过编译的命令</p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token comment">/* const NON_COMPILATION_ARGS = [
	&quot;init&quot;,              // 创建一份 webpack 配置文件
	&quot;migrate&quot;,           // 进行webpack版本迁移
	&quot;add&quot;,               // 向webpack配置文件中增加属性
	&quot;remove&quot;,            // 向webpack配置文件中删除属性
	&quot;serve&quot;,             // 运行webpack-serve
	&quot;generate-loader&quot;,   // 生成webpack-loader代码
	&quot;generate-plugin&quot;,   // 生成webpack-plugin代码
	&quot;info&quot;               // 返回与本地环境相关的一些信息
]; */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">NON_COMPILATION_ARGS</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/constants&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">NON_COMPILATION_CMD</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">===</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv <span class="token operator">=</span> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">a</span> <span class="token operator">=&gt;</span> a <span class="token operator">!==</span> <span class="token string">&quot;serve&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span>argv <span class="token operator">=</span> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token constant">NON_COMPILATION_ARGS</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">a</span> <span class="token operator">=&gt;</span> a <span class="token operator">===</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NON_COMPILATION_CMD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./utils/prompt-command&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">NON_COMPILATION_CMD</span><span class="token punctuation">,</span> <span class="token operator">...</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><!--]--><!----></div></div><p>webpack-cli 对配置文件和命令行参数进行转换最终生成配置选项参数 options，最终会根据配置参数实例化 webpack 对象，然后执行构建流程</p><h4 id="yargs-工具包" tabindex="-1"><a class="header-anchor" href="#yargs-工具包" aria-hidden="true">#</a> <code>yargs</code> 工具包</h4><p>提供命令和分组参数，动态生成 help 帮助信息</p><p>webpack-cli 使用 args 分析 参数数组(<code>config/config-args.js</code>)，将命令划分为 9 类：</p><ul><li>Config options：配置相关参数（文件名称、运行环境等）</li><li>Basic options：基础参数（entry 设置、debug 模式设置、watch 监听设置、devtool 设置）</li><li>Module options：模块参数，给 loader 设置扩展</li><li>Output options：输出参数（输出路径、输出文件名称）</li><li>Advanced options：高级用法（记录设置、缓存设置、监听频率、bail 等）</li><li>Resolving options：解析参数（alias 和解析的文件后缀设置）</li><li>Optimizing options：优化参数</li><li>Stats options：统计参数</li><li>options：通用参数（帮助命令、版本信息等）</li></ul><h3 id="tapable" tabindex="-1"><a class="header-anchor" href="#tapable" aria-hidden="true">#</a> <code>Tapable</code></h3><p>类似于 Node.js 的 EventEmitter 的库，主要是控制钩子函数的发布与订阅，控制着 webpack 的插件系统。</p><p>Tapable 库暴露了很多 Hook 类，为插件提供挂载的钩子</p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  SyncHook<span class="token punctuation">,</span>                 <span class="token comment">// 同步钩子</span>
  SyncBailHook<span class="token punctuation">,</span>             <span class="token comment">// 同步熔断钩子</span>
  SyncWaterfallHook<span class="token punctuation">,</span>        <span class="token comment">// 同步流水钩子</span>
  SyncLoopHook<span class="token punctuation">,</span>             <span class="token comment">// 同步循环钩子</span>
  AsyncParallelHook<span class="token punctuation">,</span>        <span class="token comment">// 异步并发钩子</span>
  AsyncParallelBailHook<span class="token punctuation">,</span>    <span class="token comment">// 异步并发熔断钩子</span>
  AsyncSeriesHook<span class="token punctuation">,</span>          <span class="token comment">// 异步串行钩子</span>
  AsyncSeriesBailHook<span class="token punctuation">,</span>      <span class="token comment">// 异步串行熔断钩子</span>
  AsyncSeriesWaterfallHook  <span class="token comment">// 异步串行流水钩子</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;tapable&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div><h4 id="tapable-hooks-类型" tabindex="-1"><a class="header-anchor" href="#tapable-hooks-类型" aria-hidden="true">#</a> Tapable Hooks 类型</h4><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">Hook</td><td style="text-align:left;">所有钩子的后缀</td></tr><tr><td style="text-align:left;">Waterfall</td><td style="text-align:left;">同步方法，但是会传值给下一个函数</td></tr><tr><td style="text-align:left;">Bail</td><td style="text-align:left;">熔断：当函数有任何返回值，就会在当前执行函数停止</td></tr><tr><td style="text-align:left;">Loop</td><td style="text-align:left;">监听函数返回 true 表示继续循环，返回 undefined 表示结束循环</td></tr><tr><td style="text-align:left;">Sync</td><td style="text-align:left;">同步方法</td></tr><tr><td style="text-align:left;">AsyncSeries</td><td style="text-align:left;">异步串行钩子</td></tr><tr><td style="text-align:left;">AsyncParallel</td><td style="text-align:left;">异步并行执行钩子</td></tr></tbody></table><h4 id="new-hook-新建钩子" tabindex="-1"><a class="header-anchor" href="#new-hook-新建钩子" aria-hidden="true">#</a> <code>new Hook</code> 新建钩子</h4><p>Tapable 暴露出来的都是类方法，new 一个类方法获得我们需要的钩子。</p><p>class 接收数组参数 options，非必传，类方法会根据传参，接收同样数量的参数。</p><p><code>const hook1 = new SyncHook([&#39;arg1&#39;, &#39;arg2&#39;, &#39;arg3&#39;]);</code></p><h4 id="钩子的绑定与执行" tabindex="-1"><a class="header-anchor" href="#钩子的绑定与执行" aria-hidden="true">#</a> 钩子的绑定与执行</h4><p>Tapable 提供了同步和异步绑定钩子的方法，并且它们都有绑定事件和执行事件对应的方法。</p><table><thead><tr><th style="text-align:left;">Sync*</th><th style="text-align:left;">Async*</th></tr></thead><tbody><tr><td style="text-align:left;">绑定：tap</td><td style="text-align:left;">绑定：tapAsync / tapPromise / tap</td></tr><tr><td style="text-align:left;">执行：call</td><td style="text-align:left;">执行：callAsync / promise</td></tr></tbody></table><h4 id="示例" tabindex="-1"><a class="header-anchor" href="#示例" aria-hidden="true">#</a> 示例</h4><p>示例 1：</p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">const</span> hook1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;arg1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;arg2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;arg3&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 绑定实践到 webpack 事件流</span>
hook1<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;hook1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 执行绑定事件</span>
<span class="token function">hook1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div><p>示例 2：</p><p>定义一个 Car 方法，在内部 hooks 上新建钩子。分别是同步钩子 accelerate，brake(accelerate 接收一个参数)，异步钩子 calculateRoutes；</p><p>使用钩子对应的绑定和执行方法</p><p>calculateRoutes 使用 tapPromise 可以返回一个 promise 对象</p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook<span class="token punctuation">,</span> AsyncSeriesHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;tapable&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">accelerate</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;newspeed&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">brake</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">calculateRoutes</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;source&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;target&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;routesList&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>brake<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;WarningLampPlugin&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;WarningLampPlugin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>accelerate<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;LoggerPlugin&#39;</span><span class="token punctuation">,</span> <span class="token parameter">newSpeed</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Accelerating to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newSpeed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">&#39;calcuateRoutes tapPromise&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> routesList<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;source&#39;</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tapPromise to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routesList<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">brake</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">accelerate</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&#39;cost&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myCar<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>calculateRoutes<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token string">&#39;Async&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Hook&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Demo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&#39;cost&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&#39;cost&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div><h4 id="tapable-与-webpack-的联系" tabindex="-1"><a class="header-anchor" href="#tapable-与-webpack-的联系" aria-hidden="true">#</a> Tapable 与 Webpack 的联系</h4><br><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">let</span> compiler<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiCompiler</span><span class="token punctuation">(</span>
    Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token function">webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsDefaulter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">infrastructureLogging</span><span class="token operator">:</span> options<span class="token punctuation">.</span>infrastructureLogging
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid argument: options&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><!--]--><!----></div></div><h3 id="webpack-流程" tabindex="-1"><a class="header-anchor" href="#webpack-流程" aria-hidden="true">#</a> Webpack 流程</h3><p>webpack 的编译都按照下面的钩子调用顺序执行：</p><p><img src="/blog/assets/webpack-flow-437bfdd4.png" alt="webpack 流程"></p><h4 id="初始化阶段" tabindex="-1"><a class="header-anchor" href="#初始化阶段" aria-hidden="true">#</a> 初始化阶段</h4><p><code>WebpackOptionsApply.js</code> 将所有的配置 options 参数转换成 webpack 内部插件 使用默认插件列表，如：</p><ul><li>output.library -&gt; LibraryTemplatePlugin</li><li>externals -&gt; ExternalsPlugin</li><li>devtool -&gt; EvalDevtoolModulePlugin, SourceMapDevToolPlugin</li><li>AMDPlugin, CommonJsPlugin</li><li>RemoveEmptyChunksPlugin</li></ul><h4 id="模块构建和-chunk-生成阶段" tabindex="-1"><a class="header-anchor" href="#模块构建和-chunk-生成阶段" aria-hidden="true">#</a> 模块构建和 chunk 生成阶段</h4><p><code>Compiler Hooks</code></p><ul><li>流程相关 <ul><li>(before-)run</li><li>(before-/after-)compile</li><li>make</li><li>(after-)emit</li><li>done</li></ul></li><li>监听相关 <ul><li>watch-run</li><li>watch-close</li></ul></li></ul><p><code>Compilation</code></p><p>Compiler 调用 Compilation 生命周期方法</p><ul><li>addEntry -&gt; addModuleChain</li><li>finish(上报模块错误)</li><li>seal</li></ul><p><code>Compilation Hooks</code></p><ul><li>模块相关 <ul><li>build-module</li><li>failed-module</li><li>succeed-module</li></ul></li><li>资源生成相关 <ul><li>module-asset</li><li>chunk-asset</li></ul></li><li>优化和 seal 相关 <ul><li>(after-)seal</li><li>optimize</li><li>optimize-modules(-basic/advanced)</li><li>after-optimize-(modules/chunks/tree)</li><li>optimize-chunk-modules(-basic/advanced)</li><li>after-optimize-chunk-modules</li><li>optimize-module/chunk-order</li><li>before-module/chunk-ids</li><li>(after-)optimize-module/chunk-ids</li><li>before/after-hash</li></ul></li></ul><p><code>ModuleFactory</code></p><center><p><img src="/blog/assets/moduleFactory-6d44cf40.png" alt="ModuleFactory"></p></center><p><code>Module</code></p><center><p><img src="/blog/assets/module-64ae8693.png" alt="Module"></p></center><p><code>NormalModule</code></p><p><code>Build</code> 方法</p><ul><li>使用 loader-runner 运行 loaders</li><li>通过 Parser 解析(内部使用 acron)</li><li>ParserPlugins 添加依赖</li></ul><h4 id="chunk-生成算法" tabindex="-1"><a class="header-anchor" href="#chunk-生成算法" aria-hidden="true">#</a> Chunk 生成算法</h4><ol><li>webpack 先将 entry 中对应的 module 都生成一个新的 chunk；</li><li>遍历 module 的依赖列表，将依赖的 module 也加入到 chunk 中；</li><li>如果一个依赖 module 是动态引入的模块，则会根据这个 module 创建一个新的 chunk，继续遍历依赖；</li><li>重复上面的过程，直到得到所有的 chunks。</li></ol><h4 id="emit-文件生成阶段" tabindex="-1"><a class="header-anchor" href="#emit-文件生成阶段" aria-hidden="true">#</a> emit 文件生成阶段</h4><p>addEntry -&gt; _addModuleChain -&gt; buildModule -&gt; module.build -&gt; runLoader(内容转化) -&gt; Parser 依赖分析 -&gt; compile -&gt; compilation.seal(资源优化) -&gt; createHash/modifyHash -&gt; createModuleAssets -&gt; emitAsset 资源对象生成 -&gt; compiler emitAssets -&gt; hooks.emit -&gt; outputFileSystem.mkdirp</p><h3 id="实现简易-webpack" tabindex="-1"><a class="header-anchor" href="#实现简易-webpack" aria-hidden="true">#</a> 实现简易 Webpack</h3><p>增强代码的可读性和维护性</p><ul><li>传统网页开发转变成 Web Apps 开发</li><li>代码复杂度在逐步提高</li><li>分离的 JS 文件/模块，便于后续代码的维护性</li><li>部署时希望把代码优化成几个 HTTP 请求</li></ul><p>常见的几种模块化方式</p><ul><li>ES module</li><li>CJS</li><li>AMD</li></ul><p>AST(Abstract syntax tree) 抽象语法树，是源代码的抽象语法结构的树状表现形式，树上的每个节点都表示源代码中的一种结构。例如 <a href="https://esprima.org/demo/parse.html" target="_blank" rel="noopener noreferrer">esprima<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="custom-container tip"><p class="custom-container-title">提示</p><ul><li>可以将 ES6 语法转换成 ES5 语法 <ul><li>通过 babylon 生成 AST</li><li>通过 babel-core 将 AST 重新生成源码</li></ul></li><li>可以分析模块之间的依赖关系 <ul><li>通过 babel-traverse 的 ImportDeclaration 方法获取依赖属性</li></ul></li><li>生成的 JS 文件可以在浏览器中运行</li><li>基本组成 <ul><li>config.js <ul><li><code>options</code> 提供 options，相当于 webpack 中的 webpack.config.js <ul><li><code>entry</code> 配置</li><li><code>output</code> 配置</li></ul></li></ul></li><li>index.js <ul><li><code>new Compiler(options).run()</code></li></ul></li><li>compiler.js <ul><li><code>class Compiler</code><ul><li><code>run()</code></li><li><code>buildModule(filename, isEntry)</code> 构建 modules</li><li><code>emitFiles()</code> 输出编译后文件</li></ul></li></ul></li><li>parser.js <ul><li><code>getAST(path)</code> 解析 AST 树</li><li><code>getDependencies(ast)</code> 从 entry 解析依赖</li><li><code>transform(ast)</code> 将 AST 重新生成 ES5 源码</li></ul></li></ul></li></ul></div><h3 id="loader-的链式调用和执行顺序" tabindex="-1"><a class="header-anchor" href="#loader-的链式调用和执行顺序" aria-hidden="true">#</a> loader 的链式调用和执行顺序</h3><p>loader 只是一个导出为函数的 JS 模块。</p><h4 id="多-loader-执行顺序" tabindex="-1"><a class="header-anchor" href="#多-loader-执行顺序" aria-hidden="true">#</a> 多 loader 执行顺序</h4><p>从后到前，串行执行</p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;less-loader&#39;</span><span class="token punctuation">]</span>
        <span class="token comment">// 执行顺序: 3 &lt;- 2 &lt;- 1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div><div class="custom-container tip"><p class="custom-container-title">提示</p><p>函数组合的两种情况</p><ul><li><p>Unix 中的 pipeline</p></li><li><p>Compose(Webpack 采用)</p><p><code>const compose = (f, g) =&gt; (...args) =&gt; f(g(...args));</code></p></li></ul></div><h4 id="loader-runner" tabindex="-1"><a class="header-anchor" href="#loader-runner" aria-hidden="true">#</a> loader-runner</h4><p>允许你在不安装 webpack 的条件下运行 loaders</p><p>作用：</p><ul><li>作为 webpack 的依赖，webpack 中使用它来执行 loader</li><li>进行 loader 的开发和调试</li></ul><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> runLoaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;loader-runner&#39;</span><span class="token punctuation">;</span>

<span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// String 资源的绝对路径（可以增加查询字符串）</span>
  <span class="token literal-property property">resource</span><span class="token operator">:</span> <span class="token string">&#39;/abs/path/to/file.txt?query&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// String[] loader的绝对路径（可以增加查询字符串）</span>
  <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token string">&#39;/abs/path/to/loader.js?query&#39;</span><span class="token punctuation">,</span>
  <span class="token comment">// 基础上下文之外的额外loader上下文</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 读取资源的函数</span>
  <span class="token literal-property property">readResource</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// err: Error?</span>
  <span class="token comment">// result.result: Buffer | String</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div><h4 id="loader-参数获取" tabindex="-1"><a class="header-anchor" href="#loader-参数获取" aria-hidden="true">#</a> loader 参数获取</h4><p>通过 loader-utils 的 getOptions 方法获取参数</p><h4 id="loader-异常处理" tabindex="-1"><a class="header-anchor" href="#loader-异常处理" aria-hidden="true">#</a> loader 异常处理</h4><ul><li><p>loader 内直接通过 throw 抛出</p></li><li><p>通过 this.callback 传递错误</p><ul><li><div class="code-tool-container language-typescript" data-ext="ts"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="ts"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-typescript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
  err<span class="token operator">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  content<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> Buffer<span class="token punctuation">,</span>
  sourceMap<span class="token operator">?</span><span class="token operator">:</span> SourceMap<span class="token punctuation">,</span>
  meta<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div></li></ul></li></ul><h4 id="loader-异步处理" tabindex="-1"><a class="header-anchor" href="#loader-异步处理" aria-hidden="true">#</a> loader 异步处理</h4><p>通过 this.async 返回一个异步函数</p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
</code></pre><!--]--><!----></div></div><h4 id="loader-缓存" tabindex="-1"><a class="header-anchor" href="#loader-缓存" aria-hidden="true">#</a> loader 缓存</h4><p>webpack 默认开启 loader 缓存，使用 <code>this.cacheable(false)</code> 关闭。</p><p>缓存条件：loader 的结果在相同的输入下有确定的输出。有依赖的 loader 无法使用缓存。</p><h4 id="loader-文件输出" tabindex="-1"><a class="header-anchor" href="#loader-文件输出" aria-hidden="true">#</a> loader 文件输出</h4><p>通过 this.emitFile 进行文件写入</p><h4 id="自动合成雪碧图-loader" tabindex="-1"><a class="header-anchor" href="#自动合成雪碧图-loader" aria-hidden="true">#</a> 自动合成雪碧图 loader</h4><p>将 <code>background: url(&#39;a.png?__sprite&#39;);</code> 和 <code>background: url(&#39;b.png?__sprite&#39;);</code> 转换为 <code>background: url(&#39;sprite.png&#39;);</code></p><p><strong>使用<a href="https://github.com/twolfson/spritesmith" target="_blank" rel="noopener noreferrer">spritesmith<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>将多张图片合成为一张图片</strong></p><p><strong>关键处理逻辑</strong></p><p>通过匹配获取对应后缀的路径进行路径解析，再传递给 Spritesmith 处理</p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Spritesmith <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;spritesmith&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> imgs <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">url\((\S*)\?__sprite</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> matchedImgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> imgs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> img <span class="token operator">=</span> imgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">url\((\S*)\?__sprite</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    matchedImgs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Spritesmith<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">src</span><span class="token operator">:</span> matchedImgs <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;dist/sprite.jpg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span> result<span class="token punctuation">.</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">url\((\S*)\?__sprite\)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> $0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> $0<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">.</span>coordinates<span class="token punctuation">[</span>filePath<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(&quot;dist/sprite.jpg&quot;);\n  background-position: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;\n  background-size: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>width<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div><h3 id="plugin-插件开发" tabindex="-1"><a class="header-anchor" href="#plugin-插件开发" aria-hidden="true">#</a> plugin 插件开发</h3><p>插件没有像 loader 那样的独立运行环境，只能在 webpack 里面运行。</p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token comment">// plugin.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">Plugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;Plugin&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Plugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div><h4 id="plugin-参数获取" tabindex="-1"><a class="header-anchor" href="#plugin-参数获取" aria-hidden="true">#</a> plugin 参数获取</h4><p>通过插件的构造函数进行获取。</p><h4 id="plugin-异常处理" tabindex="-1"><a class="header-anchor" href="#plugin-异常处理" aria-hidden="true">#</a> plugin 异常处理</h4><ul><li><p>参数校验阶段可以直接 throw 的方式抛出</p></li><li><p>通过 compilation 对象的 warnings 和 errors 接收</p><ul><li><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code>compilation<span class="token punctuation">.</span>warnings<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;warning&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
compilation<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div></li></ul></li></ul><h4 id="plugin-文件输出" tabindex="-1"><a class="header-anchor" href="#plugin-文件输出" aria-hidden="true">#</a> plugin 文件输出</h4><p>compilation 上的 assets 可用于文件输出</p><ul><li><p>可以将 zip 资源包设置到 <code>compilation.assets</code> 对象上</p></li><li><p>需要使用 <a href="https://github.com/webpack/webpack-sources" target="_blank" rel="noopener noreferrer">webpack-source<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> RawSource <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack-source&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;Plugin&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RawSource</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div></li></ul></li></ul><h4 id="插件扩展-插件的插件" tabindex="-1"><a class="header-anchor" href="#插件扩展-插件的插件" aria-hidden="true">#</a> 插件扩展(插件的插件)</h4><p>插件自身也可以通过暴露 hooks 的方式进行自身扩展，如 html-webpack-plugin：</p><ul><li>html-webpack-plugin-alter-chunks (Sync)</li><li>html-webpack-plugin-before-html-generation (Async)</li><li>html-webpack-plugin-alter-asset-tags (Async)</li><li>html-webpack-plugin-after-html-processing (Async)</li><li>html-webpack-plugin-after-emit (Async)</li></ul><h4 id="压缩构建资源位-zip-包插件" tabindex="-1"><a class="header-anchor" href="#压缩构建资源位-zip-包插件" aria-hidden="true">#</a> 压缩构建资源位 zip 包插件</h4><ul><li><p>生成的 zip 包文件名称可以通过插件传入</p></li><li><p>需要使用 compiler 对象上的特定 hooks 进行资源生成</p></li><li><p>使用 <a href="https://github.com/Stuk/jszip" target="_blank" rel="noopener noreferrer">jszip<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 压缩 zip 包</p><ul><li><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">const</span> zip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

zip<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">&quot;Hello.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello World\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> img <span class="token operator">=</span> zip<span class="token punctuation">.</span><span class="token function">folder</span><span class="token punctuation">(</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">&quot;smile.gif&quot;</span><span class="token punctuation">,</span> imgData<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">base64</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

zip<span class="token punctuation">.</span><span class="token function">generateAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;blob&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// see FileSaver.js</span>
    <span class="token function">saveAs</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">&quot;example.zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
Results in a zip containing
Hello.txt
images/
    smile.gif
*/</span>
</code></pre><!--]--><!----></div></div></li></ul></li><li><p>emit (AsyncSeriesHook) 生成文件阶段， 读取 <code>compilation.assets</code>对象的值，故 将 zip 资源包设置到 <code>compilation.assets</code> 对象上</p></li></ul><p><strong>关键处理逻辑</strong></p><div class="code-tool-container language-javascript" data-ext="js"><div class="window-controls" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="14" viewBox="0 0 54 14"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><circle cx="6" cy="6" r="6" fill="#FF5F56" stroke="#E0443E" stroke-width=".5"></circle><circle cx="26" cy="6" r="6" fill="#FFBD2E" stroke="#DEA123" stroke-width=".5"></circle><circle class="" cx="46" cy="6" r="6" fill="#27C93F" stroke="#1AAB29" stroke-width=".5"></circle><!----><!----></g></svg></div><div class="code-toolbox" data-ext="js"><!-- <Xicons icon="Edit" @click="handleEdit" /> --><!----><!----></div><!-- <CodeEditor v-if="isEdit" :size="size" v-bind="props" /> --><div class="code-content-container"><!--[--><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> JSZip <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;jszip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> RawSource <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack-sources&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> zip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSZip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">ZipPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&#39;ZipPlugin&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> folder <span class="token operator">=</span> zip<span class="token punctuation">.</span><span class="token function">folder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>compilation<span class="token punctuation">.</span>assets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">filename</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> source <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        folder<span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      zip<span class="token punctuation">.</span><span class="token function">generateAsync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;nodebuffer&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">content</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> outputPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>compilation<span class="token punctuation">.</span>options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>filename <span class="token operator">+</span> <span class="token string">&#39;.zip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> outputRelativePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>
          compilation<span class="token punctuation">.</span>options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
          outputPath
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>outputRelativePath<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RawSource</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><!--]--><!----></div></div></div><!--]--><!--[--><!--]--></div><!-- <PageMeta v-if="useMeta" /> --><!----><!--[--><!--[--><!--]--><div class="footer"><p> MIT Licensed | Copyright © 2020-present <a href="https://github.com/moriarty47" target="_blank" rel="noopener noreferrer"> Moriarty47 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z" data-darkreader-inline-fill="" style="--darkreader-inline-fill:currentColor;"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9" data-darkreader-inline-fill="" style="--darkreader-inline-fill:currentColor;"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!--]--></main><!--]--><div class="page-catalog-container"><h5 class="tip">FLOOR</h5><ul><!--[--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_2"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#webpack-源码分析" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Webpack 源码分析"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="Webpack 源码分析"><!--[-->Webpack 源码分析<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu page-catalog-menu-depth_3"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#webpack-命令" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="webpack 命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="webpack 命令"><!--[-->webpack 命令<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_3"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#webpack-cli-命令" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="webpack-cli 命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="webpack-cli 命令"><!--[-->webpack-cli 命令<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#从-non-compilation-cmd-分析出不需要编译的命令" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="从 NON_COMPILATION_CMD 分析出不需要编译的命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="从 NON_COMPILATION_CMD 分析出不需要编译的命令"><!--[-->从 NON_COMPILATION_CMD 分析出不需要编译的命令<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#yargs-工具包" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="yargs 工具包"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="yargs 工具包"><!--[-->yargs 工具包<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_3"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#tapable" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Tapable"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="Tapable"><!--[-->Tapable<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#tapable-hooks-类型" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Tapable Hooks 类型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="Tapable Hooks 类型"><!--[-->Tapable Hooks 类型<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#new-hook-新建钩子" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="new Hook 新建钩子"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="new Hook 新建钩子"><!--[-->new Hook 新建钩子<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#钩子的绑定与执行" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="钩子的绑定与执行"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="钩子的绑定与执行"><!--[-->钩子的绑定与执行<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#示例" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="示例"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="示例"><!--[-->示例<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#tapable-与-webpack-的联系" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Tapable 与 Webpack 的联系"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="Tapable 与 Webpack 的联系"><!--[-->Tapable 与 Webpack 的联系<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_3"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#webpack-流程" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Webpack 流程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="Webpack 流程"><!--[-->Webpack 流程<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#初始化阶段" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="初始化阶段"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="初始化阶段"><!--[-->初始化阶段<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#模块构建和-chunk-生成阶段" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="模块构建和 chunk 生成阶段"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="模块构建和 chunk 生成阶段"><!--[-->模块构建和 chunk 生成阶段<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#chunk-生成算法" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Chunk 生成算法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="Chunk 生成算法"><!--[-->Chunk 生成算法<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#emit-文件生成阶段" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="emit 文件生成阶段"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="emit 文件生成阶段"><!--[-->emit 文件生成阶段<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_3"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#实现简易-webpack" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="实现简易 Webpack"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="实现简易 Webpack"><!--[-->实现简易 Webpack<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_3"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#loader-的链式调用和执行顺序" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="loader 的链式调用和执行顺序"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="loader 的链式调用和执行顺序"><!--[-->loader 的链式调用和执行顺序<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#多-loader-执行顺序" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="多 loader 执行顺序"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="多 loader 执行顺序"><!--[-->多 loader 执行顺序<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#loader-runner" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="loader-runner"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="loader-runner"><!--[-->loader-runner<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#loader-参数获取" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="loader 参数获取"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="loader 参数获取"><!--[-->loader 参数获取<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#loader-异常处理" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="loader 异常处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="loader 异常处理"><!--[-->loader 异常处理<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#loader-异步处理" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="loader 异步处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="loader 异步处理"><!--[-->loader 异步处理<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#loader-缓存" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="loader 缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="loader 缓存"><!--[-->loader 缓存<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#loader-文件输出" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="loader 文件输出"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="loader 文件输出"><!--[-->loader 文件输出<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#自动合成雪碧图-loader" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="自动合成雪碧图 loader"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="自动合成雪碧图 loader"><!--[-->自动合成雪碧图 loader<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_3"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#plugin-插件开发" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="plugin 插件开发"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="plugin 插件开发"><!--[-->plugin 插件开发<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#plugin-参数获取" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="plugin 参数获取"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="plugin 参数获取"><!--[-->plugin 参数获取<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#plugin-异常处理" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="plugin 异常处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="plugin 异常处理"><!--[-->plugin 异常处理<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#plugin-文件输出" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="plugin 文件输出"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="plugin 文件输出"><!--[-->plugin 文件输出<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#插件扩展-插件的插件" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="插件扩展(插件的插件)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="插件扩展(插件的插件)"><!--[-->插件扩展(插件的插件)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu page-catalog-menu-depth_4"><a aria-current="page" href="/blog/Bundler/Webpack/sourcecode.html#压缩构建资源位-zip-包插件" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="压缩构建资源位 zip 包插件"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;" title="压缩构建资源位 zip 包插件"><!--[-->压缩构建资源位 zip 包插件<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--><!--]--></ul></div><!--]--></div><!----><!--]--></div>
    <div id="modal-container"></div>
    <div id="ctxmenu-container"></div>
    <script type="module" src="/blog/assets/app-bf7bc9cc.js" defer></script>
  </body>
</html>
