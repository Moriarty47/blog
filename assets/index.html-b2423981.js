import{_ as r,M as o,p as d,q as m,Q as n,t as s,N as a,V as t,a0 as p}from"./framework-5411b43d.js";const v={},b=n("h2",{id:"vue-原理-mvvm-的双向绑定",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#vue-原理-mvvm-的双向绑定","aria-hidden":"true"},"#"),s(" Vue 原理 - MVVM 的双向绑定")],-1),A=n("h3",{id:"实现数据绑定的方法",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#实现数据绑定的方法","aria-hidden":"true"},"#"),s(" 实现数据绑定的方法：")],-1),B={href:"https://backbonejs.org/",target:"_blank",rel:"noopener noreferrer"},E=n("p",null,[s("使用自定义的 "),n("code",null,"data"),s(" 属性在 HTML 代码中指明绑定。所有绑定过的对象以及 DOM 元素都将订阅一个发布者对象。任何时候这个对象或者 HTML 输入字段被侦测到发生变化，会触发发布者通知事件，告知所有订阅者发生的变化，相应的，如果数据发生相应变化，将会广播并传播到所有绑定的对象和元素上。")],-1),h={href:"https://angularjs.org/",target:"_blank",rel:"noopener noreferrer"},f=p("<p>在 angular.js 作用域内定义的变量发生变化时（在作用域 <code>scope</code> 内定义的所有变量都有一个 <code>watch</code>，用于监听变量的状态），触发所有变量的循环检查（从根作用 <code>rootscope</code> 开始向内检查，即按锚的深度检查，每一次独立的循环检查为一次 <code>digest cycle</code> ），当检查到数据变更时，则同步数据（如果 <code>model</code> 中的数据发生变更，则向 <code>view</code> 同步，如果 <code>view</code> 中的数据发生变更，则向 <code>model</code> 同步），直到所有数据稳定。当所有数据稳定后，还会执行一次额外的全量检查。脏值检测有上限，一般来说超过 10 次循环检查，第 11 次就会抛出错误。</p><p>angular.js 只在如下事件触发时进行脏值检查：</p><ul><li>DOM 事件(如用户输入文本，<code>ng-click</code>)</li><li>XHR 响应事件( <code>$http</code> )</li><li>浏览器 Localtion 变更事件( <code>$location</code> )</li><li>定时器事件( <code>$timeout</code> 、<code>$interval</code> )</li><li>执行 <code>$digest</code> 和 <code>$apply</code> 方法</li></ul>",3),D={href:"https://v2.cn.vuejs.org/",target:"_blank",rel:"noopener noreferrer"},y={href:"https://cn.vuejs.org/",target:"_blank",rel:"noopener noreferrer"},C=n("p",null,[s("vue.js 通过数据劫持(2.x 版本通过 "),n("code",null,"Object.defineProperty()"),s(" 实现，3.x 版本通过 "),n("code",null,"Proxy"),s(" 实现)，劫持各个属性的 "),n("code",null,"getter"),s(" 与 "),n("code",null,"setter"),s(" 并结合发布订阅模式，在数据变动时发布消息给订阅者，触发相应的监听回调。")],-1),w=p('<h3 id="实现-vue-js-2-x-的数据绑定" tabindex="-1"><a class="header-anchor" href="#实现-vue-js-2-x-的数据绑定" aria-hidden="true">#</a> 实现 vue.js 2.x 的数据绑定</h3><p>实现 MVVM 的双向绑定需要实现以下几点：</p><ul><li>数据监听器 <code>Observer</code>。对数据对象的所有属性进行监听，如果有变动则获取最新值并通知订阅者；</li><li>指令解析器 <code>Compiler</code>。对每个元素节点的指令进行扫描与解析，根据指令模板替换数据，以及绑定相应的更新函数；</li><li>观察者 <code>Watcher</code>。连接 <code>Observer</code> 与 <code>Compiler</code>的桥梁，能够订阅并收到每个属性变动的通知，执行指令绑定的相应回调函数，从而更新视图。</li><li>MVVM 构造器。关联上述三者。</li></ul>',3),g=p('<h4 id="数据监听器-observer" tabindex="-1"><a class="header-anchor" href="#数据监听器-observer" aria-hidden="true">#</a> 数据监听器 <code>Observer</code></h4><p>通过 <code>Object.defineProperty()</code> 监听属性的变动。对于要 <code>observe</code> 的数据对象进行递归遍历，对其所有属性包括子属性对象的属性都添加 <code>getter</code> 和 <code>setter</code>，这样的话，对该数据对象的属性进行赋值操作，就会触发 <code>setter</code> ，即监听到了数据变化。</p>',2),x=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Observer"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"data"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("data "),n("span",{class:"token operator"},"="),s(" data"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"init"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"defineReactive"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("data"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" val")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"observe"),n("span",{class:"token punctuation"},"("),s("val"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 递归监听子属性"),s(`
    Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defineProperty"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token literal-property property"},"enumerable"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token literal-property property"},"configurable"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" val"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"detect change: "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("val"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"}," --> "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("newVal"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        val `),n("span",{class:"token operator"},"="),s(" newVal"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"data"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"keys"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defineReactive"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" data"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token function"},"observe"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"data"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("data "),n("span",{class:"token operator"},"||"),s(),n("span",{class:"token keyword"},"typeof"),s(" data "),n("span",{class:"token operator"},"!=="),s(),n("span",{class:"token string"},"'object'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Observer"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])],-1),_=n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})],-1),F=n("p",null,"监听示例",-1),V=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" foo "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token literal-property property"},"name"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'Walter White'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"children"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token function"},"observe"),n("span",{class:"token punctuation"},"("),s("foo"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
foo`),n("span",{class:"token punctuation"},"."),s("name "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'Heisenberg'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 'detect change: Walter White --> Heisenberg'"),s(`
foo`),n("span",{class:"token punctuation"},"."),s("children"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'Walter Junior'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 'detect change: undefined --> Walter Junior'"),s(`
`)])],-1),j=n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})],-1),O=n("h4",{id:"依赖订阅器-dep",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#依赖订阅器-dep","aria-hidden":"true"},"#"),s(" 依赖订阅器 "),n("code",null,"Dep")],-1),N=n("p",null,"现在我们可以监听数据的变化了，同时我们需要实现消息收集器，收集订阅者(数据依赖)，并在数据变动时触发通知同时调用订阅者的更新时间。",-1),W=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"let"),s(" uid "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Dep"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("id "),n("span",{class:"token operator"},"="),s(" uid"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("subscribers "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"subscriber"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("subscribers"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),s("subscriber"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"remove"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"subscriber"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" index "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("subscribers"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"findIndex"),n("span",{class:"token punctuation"},"("),s("subscriber"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("index "),n("span",{class:"token operator"},"!=="),s(),n("span",{class:"token operator"},"-"),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("subscribers"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"splice"),n("span",{class:"token punctuation"},"("),s("index"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"notify"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("subscribers"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"subscriber"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      subscriber`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Observer"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"data"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("data "),n("span",{class:"token operator"},"="),s(" data"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"init"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"defineReactive"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("data"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" val")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" dep "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Dep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token function"},"observe"),n("span",{class:"token punctuation"},"("),s("val"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 递归监听子属性"),s(`
    Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defineProperty"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token literal-property property"},"enumerable"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token literal-property property"},"configurable"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" val"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("val "),n("span",{class:"token operator"},"==="),s(" newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`
        console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"detect change: "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("val"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"}," --> "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("newVal"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        val `),n("span",{class:"token operator"},"="),s(" newVal"),n("span",{class:"token punctuation"},";"),s(`
        dep`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"notify"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"data"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"keys"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"key"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defineReactive"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" data"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])],-1),M=n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})],-1),U=n("p",null,"添加订阅器示例",-1),$=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" foo "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token literal-property property"},"name"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'Walter White'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token literal-property property"},"children"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"undefined"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token function"},"observe"),n("span",{class:"token punctuation"},"("),s("foo"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
foo`),n("span",{class:"token punctuation"},"."),s("name "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'Heisenberg'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 'detect change: Walter White --> Heisenberg'"),s(`
foo`),n("span",{class:"token punctuation"},"."),s("children"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},"'Walter Junior'"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 'detect change: undefined --> Walter Junior'"),s(`
`)])],-1),T=n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})],-1),H=n("h4",{id:"依赖订阅器-添加订阅者watcher",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#依赖订阅器-添加订阅者watcher","aria-hidden":"true"},"#"),s(" 依赖订阅器 添加订阅者"),n("code",null,"Watcher")],-1),I=n("p",null,[s("根据"),n("a",{href:"#%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E5%9B%BE"},"上图"),s("，可以看出需要通过 "),n("code",null,"Dep"),s(" 添加订阅者 "),n("code",null,"Watcher"),s(" 。")],-1),P=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Watcher"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("vm"),n("span",{class:"token punctuation"},","),s(" expOrFn"),n("span",{class:"token punctuation"},","),s(" cb")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("vm "),n("span",{class:"token operator"},"="),s(" vm"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("expOrFn "),n("span",{class:"token operator"},"="),s(" expOrFn"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("cb "),n("span",{class:"token operator"},"="),s(" cb"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("depIds "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"typeof"),s(" expOrFn "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'function'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("getter "),n("span",{class:"token operator"},"="),s(" expOrFn"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("getter "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"parseGetter"),n("span",{class:"token punctuation"},"("),s("expOrFn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"trim"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"update"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" oldVal "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("value "),n("span",{class:"token operator"},"!=="),s(" oldVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("value "),n("span",{class:"token operator"},"="),s(" value"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"cb"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("vm"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},","),s(" oldVal"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token doc-comment comment"},`/**
   * 将当前订阅者指向自身
   * 触发getter，将自己的属性
   */`),s(`
  `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    Dep`),n("span",{class:"token punctuation"},"."),s("target "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getter"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("vm"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("vm"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    Dep`),n("span",{class:"token punctuation"},"."),s("target "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" value"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"parseGetter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"exp"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token regex"},[n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-source language-regex"},"[^\\w.$]"),n("span",{class:"token regex-delimiter"},"/")]),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"test"),n("span",{class:"token punctuation"},"("),s("exp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" exps "),n("span",{class:"token operator"},"="),s(" exp"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"split"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'.'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"obj"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"let"),s(" i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(" len "),n("span",{class:"token operator"},"="),s(" exps"),n("span",{class:"token punctuation"},"."),s("length"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"<"),s(" len"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("obj"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`
        obj `),n("span",{class:"token operator"},"="),s(" obj"),n("span",{class:"token punctuation"},"["),s("exps"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
      `),n("span",{class:"token keyword"},"return"),s(" obj"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token doc-comment comment"},[s(`/**
   * 维护一个depIds用来存储新添加属性，并为新的属性增加新的setter与dep，
   * 并将当前watcher加入新的dep中，这样对应的watcher才能得到通知。
   * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"{"),s("Dep"),n("span",{class:"token punctuation"},"}")]),s(),n("span",{class:"token parameter"},"dep"),s(` 
   */`)]),s(`
  `),n("span",{class:"token function"},"addDep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"dep"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("depIds"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"hasOwnProperty"),n("span",{class:"token punctuation"},"("),s("dep"),n("span",{class:"token punctuation"},"."),s("id"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      dep`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"add"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("depIds"),n("span",{class:"token punctuation"},"["),s("dep"),n("span",{class:"token punctuation"},"."),s("id"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" dep"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])],-1),L=n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})],-1),R=n("h4",{id:"指令解析器-compiler",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#指令解析器-compiler","aria-hidden":"true"},"#"),s(" 指令解析器 "),n("code",null,"Compiler")],-1),S=n("p",null,"解析指令模板，将模板中的变量替换成数据，初始化渲染页面，将每个指令的对应节点绑定更新函数，添加监听数据订阅者，当数据变动，收到依赖订阅器通知，更新视图。",-1),J=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Compiler"),s(),n("span",{class:"token punctuation"},"{"),s(`

  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("el"),n("span",{class:"token punctuation"},","),s(" vm")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$vm "),n("span",{class:"token operator"},"="),s(" vm"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$el "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isElementNode"),n("span",{class:"token punctuation"},"("),s("el"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"?"),s(" el "),n("span",{class:"token operator"},":"),s(" document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"querySelector"),n("span",{class:"token punctuation"},"("),s("el"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$el"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$fragment "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"node2Fragment"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$el"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$el"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"appendChild"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$fragment"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"init"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"compileElement"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$fragment"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token doc-comment comment"},[s(`/**
   * 遍历所有节点及其子节点，扫描解析编译，
   * 调用对应指令渲染函数渲染数据并绑定对应的更新函数
   * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"{"),s("Element"),n("span",{class:"token punctuation"},"}")]),s(),n("span",{class:"token parameter"},"el"),s(` 
   */`)]),s(`
  `),n("span",{class:"token function"},"compileElement"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"el"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" childNodes "),n("span",{class:"token operator"},"="),s(" el"),n("span",{class:"token punctuation"},"."),s("childNodes"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"slice"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),s("childNodes"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"node"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" text "),n("span",{class:"token operator"},"="),s(" node"),n("span",{class:"token punctuation"},"."),s("textContent"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" reg "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token regex"},[n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-source language-regex"},"\\{\\{(.*)\\}\\}"),n("span",{class:"token regex-delimiter"},"/")]),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isElementNode"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"compile"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isTextNode"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"&&"),s(" reg"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"test"),n("span",{class:"token punctuation"},"("),s("text"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"compileText"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(" RegExp"),n("span",{class:"token punctuation"},"."),s("$1"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"trim"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},"."),s("childNodes "),n("span",{class:"token operator"},"&&"),s(" node"),n("span",{class:"token punctuation"},"."),s("childNodes"),n("span",{class:"token punctuation"},"."),s("length"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"compileElement"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"compile"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"node"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" nodeAttrs "),n("span",{class:"token operator"},"="),s(" node"),n("span",{class:"token punctuation"},"."),s("attributes"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"slice"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),s("nodeAttrs"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"attr"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" attrName "),n("span",{class:"token operator"},"="),s(" attr"),n("span",{class:"token punctuation"},"."),s("name"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isDirective"),n("span",{class:"token punctuation"},"("),s("attrName"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"const"),s(" exp "),n("span",{class:"token operator"},"="),s(" attr"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"const"),s(" dir "),n("span",{class:"token operator"},"="),s(" attrName"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"substring"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isEventDirective"),n("span",{class:"token punctuation"},"("),s("dir"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
          Utils`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"eventHandler"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(" dir"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
          Utils`),n("span",{class:"token punctuation"},"["),s("dir"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"&&"),s(" Utils"),n("span",{class:"token punctuation"},"["),s("dir"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`

        node`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"removeAttribute"),n("span",{class:"token punctuation"},"("),s("attrName"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"node2Fragment"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"el"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" fragment "),n("span",{class:"token operator"},"="),s(" document"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"createDocumentFragment"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" child "),n("span",{class:"token operator"},"="),s(" el"),n("span",{class:"token punctuation"},"."),s("firstChild"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"while"),s(),n("span",{class:"token punctuation"},"("),s("child"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      fragment`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"appendChild"),n("span",{class:"token punctuation"},"("),s("child"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      child `),n("span",{class:"token operator"},"="),s(" el"),n("span",{class:"token punctuation"},"."),s("firstChild"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" fragment"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"compileText"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" exp")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    Utils`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"text"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"isElementNode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"node"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" node"),n("span",{class:"token punctuation"},"."),s("nodeType "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"isTextNode"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"node"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" node"),n("span",{class:"token punctuation"},"."),s("nodeType "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"isDirective"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"attr"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" attr"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"startsWith"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'v-'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"isEventDirective"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"dir"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" dir"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"startsWith"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'on'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"var"),s(" Utils "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"text"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'text'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"html"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'html'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'class'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"model"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'model'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" val "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_getVMVal"),n("span",{class:"token punctuation"},"("),s("vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    node`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'input'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token parameter"},"e"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" newVal "),n("span",{class:"token operator"},"="),s(" e"),n("span",{class:"token punctuation"},"."),s("target"),n("span",{class:"token punctuation"},"."),s("value"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("val "),n("span",{class:"token operator"},"==="),s(" newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"return"),n("span",{class:"token punctuation"},";"),s(`

      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_setVMVal"),n("span",{class:"token punctuation"},"("),s("vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(" newVal"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      val `),n("span",{class:"token operator"},"="),s(" newVal"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(" dir")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" updaterFn "),n("span",{class:"token operator"},"="),s(" Updater"),n("span",{class:"token punctuation"},"["),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("dir"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"Updater"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    updaterFn `),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token function"},"updaterFn"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_getVMVal"),n("span",{class:"token punctuation"},"("),s("vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"watchUserConfigFile"),n("span",{class:"token punctuation"},"("),s("vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("value"),n("span",{class:"token punctuation"},","),s(" oldVal")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      updaterFn `),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token function"},"updaterFn"),n("span",{class:"token punctuation"},"("),s("node"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},","),s(" oldVal"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"eventHandler"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(" dir")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" eventType "),n("span",{class:"token operator"},"="),s(" dir"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"split"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"':'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" fn "),n("span",{class:"token operator"},"="),s(" vm"),n("span",{class:"token punctuation"},"."),s("$options"),n("span",{class:"token punctuation"},"."),s("methods "),n("span",{class:"token operator"},"&&"),s(" vm"),n("span",{class:"token punctuation"},"."),s("$options"),n("span",{class:"token punctuation"},"."),s("methods"),n("span",{class:"token punctuation"},"["),s("exp"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("eventType "),n("span",{class:"token operator"},"&&"),s(" fn"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      node`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"addEventListener"),n("span",{class:"token punctuation"},"("),s("eventType"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function"},"fn"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),s("vm"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"_getVMVal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("vm"),n("span",{class:"token punctuation"},","),s(" exp")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" val "),n("span",{class:"token operator"},"="),s(" vm"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" exp "),n("span",{class:"token operator"},"="),s(" exp"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"split"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'.'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    exp`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"k"),s(),n("span",{class:"token operator"},"=>"),s(" val "),n("span",{class:"token operator"},"="),s(" val"),n("span",{class:"token punctuation"},"["),s("k"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"return"),s(" val"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"_setVMVal"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("vm"),n("span",{class:"token punctuation"},","),s(" exp"),n("span",{class:"token punctuation"},","),s(" value")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" val "),n("span",{class:"token operator"},"="),s(" vm"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" exp "),n("span",{class:"token operator"},"="),s(" exp"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"split"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'.'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    exp`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("k"),n("span",{class:"token punctuation"},","),s(" i")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("i "),n("span",{class:"token operator"},"<"),s(" exp"),n("span",{class:"token punctuation"},"."),s("length "),n("span",{class:"token operator"},"-"),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        val `),n("span",{class:"token operator"},"="),s(" val"),n("span",{class:"token punctuation"},"["),s("k"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        val`),n("span",{class:"token punctuation"},"["),s("k"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" value"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"var"),s(" Updater "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"textUpdater"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" value")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    node`),n("span",{class:"token punctuation"},"."),s("textContent "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"typeof"),s(" value "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'undefined'"),s(),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token string"},"''"),s(),n("span",{class:"token operator"},":"),s(" value"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"htmlUpdater"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" value")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    node`),n("span",{class:"token punctuation"},"."),s("innerHTML "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"typeof"),s(" value "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'undefined'"),s(),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token string"},"''"),s(),n("span",{class:"token operator"},":"),s(" value"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"classUpdater"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},","),s(" oldVal")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"let"),s(" className "),n("span",{class:"token operator"},"="),s(" node"),n("span",{class:"token punctuation"},"."),s("className"),n("span",{class:"token punctuation"},";"),s(`
    className `),n("span",{class:"token operator"},"="),s(" className"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"replace"),n("span",{class:"token punctuation"},"("),s("oldVal"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"''"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"replace"),n("span",{class:"token punctuation"},"("),n("span",{class:"token regex"},[n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-source language-regex"},"\\s$"),n("span",{class:"token regex-delimiter"},"/")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"''"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" space "),n("span",{class:"token operator"},"="),s(" className "),n("span",{class:"token operator"},"&&"),s(),n("span",{class:"token function"},"String"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token string"},"' '"),s(),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"''"),n("span",{class:"token punctuation"},";"),s(`
    node`),n("span",{class:"token punctuation"},"."),s("className "),n("span",{class:"token operator"},"="),s(" className "),n("span",{class:"token operator"},"+"),s(" space "),n("span",{class:"token operator"},"+"),s(" value"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token function"},"modelUpdater"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("node"),n("span",{class:"token punctuation"},","),s(" value"),n("span",{class:"token punctuation"},","),s(" oldVal")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    node`),n("span",{class:"token punctuation"},"."),s("value "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"typeof"),s(" value "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'undefined'"),s(),n("span",{class:"token operator"},"?"),s(),n("span",{class:"token string"},"''"),s(),n("span",{class:"token operator"},":"),s(" value"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),G=n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})],-1),q=p('<h4 id="入口-mvvm-构造器" tabindex="-1"><a class="header-anchor" href="#入口-mvvm-构造器" aria-hidden="true">#</a> 入口 MVVM 构造器</h4><p>数据绑定入口，关联上述三者，使用 <code>Observer</code> 监听自身 <code>model</code> 数据变化，使用 <code>Compiler</code> 解析编译模板指令，使用 <code>Watcher</code> 连接 <code>Observer</code> 与 <code>Compiler</code>，使其可以相互通信。从而实现双向绑定。</p>',2),Q=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"MVVM"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("options "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$options "),n("span",{class:"token operator"},"="),s(" options"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$options"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" data "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_data"),n("span",{class:"token punctuation"},";"),s(`
    Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"keys"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"key"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_proxyData"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"_initComputed"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token function"},"observe"),n("span",{class:"token punctuation"},"("),s("data"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$compiler "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Compiler"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},"."),s("el "),n("span",{class:"token operator"},"||"),s(" document"),n("span",{class:"token punctuation"},"."),s("body"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token doc-comment comment"},[s(`/**
   * 属性代理方法，将_data中的属性代理到this本身，方便访问。
   * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"{"),s("string"),n("span",{class:"token punctuation"},"}")]),s(),n("span",{class:"token parameter"},"key"),s(` 
   * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token keyword"},"void"),n("span",{class:"token punctuation"},"}")]),s(),n("span",{class:"token parameter"},"setter"),s(` 
   */`)]),s(`
  `),n("span",{class:"token function"},"_proxyData"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("key"),n("span",{class:"token punctuation"},","),s(" setter")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" _this "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},";"),s(`
    setter `),n("span",{class:"token operator"},"="),s(" setter "),n("span",{class:"token operator"},"||"),s(" Object"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defineProperty"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token literal-property property"},"enumerable"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token literal-property property"},"configurable"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" _this"),n("span",{class:"token punctuation"},"."),s("_data"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("newVal"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("_data"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(" newVal"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"_initComputed"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" computed "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("$options"),n("span",{class:"token punctuation"},"."),s("computed"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"typeof"),s(" computed "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'object'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"keys"),n("span",{class:"token punctuation"},"("),s("computed"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"key"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"defineProperty"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token literal-property property"},"get"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"typeof"),s(" computed"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},"'function'"),s(`
            `),n("span",{class:"token operator"},"?"),s(" computed"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),s(`
            `),n("span",{class:"token operator"},":"),s(" computed"),n("span",{class:"token punctuation"},"["),s("key"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),s("get"),n("span",{class:"token punctuation"},","),s(`
          `),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"$watch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("key"),n("span",{class:"token punctuation"},","),s(" cb")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Watcher"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},","),s(" key"),n("span",{class:"token punctuation"},","),s(" cb"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])],-1),X=n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})],-1),z=n("h4",{id:"mvvm-vue2-示例",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#mvvm-vue2-示例","aria-hidden":"true"},"#"),s(" MVVM Vue2 示例")],-1),K=n("br",null,null,-1),Y=n("h4",{id:"mvvm-vue3-示例",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#mvvm-vue3-示例","aria-hidden":"true"},"#"),s(" MVVM Vue3 示例")],-1),Z=n("br",null,null,-1);function nn(sn,an){const c=o("ExternalLinkIcon"),l=o("Mermaid"),u=o("ClientOnly"),e=o("CodeTool"),i=o("MvvmVue2"),k=o("MvvmVue3");return d(),m("div",null,[b,A,n("ul",null,[n("li",null,[n("p",null,[s("发布订阅模式 "),n("a",B,[s("backbone.js"),a(c)])]),E]),n("li",null,[n("p",null,[s("脏值检查 "),n("a",h,[s("angular.js"),a(c)])]),f]),n("li",null,[n("p",null,[s("数据劫持 "),n("a",D,[s("vue.js 2.x"),a(c)]),s("/"),n("a",y,[s("3.x"),a(c)])]),C])]),w,a(u,null,{default:t(()=>[a(l,{id:"数据绑定图",no:"1-1",graph:"flowchart%20LR%0A%20%20Contructor(%5B%22new%20MVVM()%22%5D)%20--%3E%20Observer%5B%22Observer%5Cn%E5%8A%AB%E6%8C%81%E7%9B%91%E5%90%AC%E6%89%80%E6%9C%89%E5%B1%9E%E6%80%A7%22%5D%0A%20%20Contructor(%5B%22new%20MVVM()%22%5D)%20--%3E%20Compiler%5B%22Compiler%5Cn%E8%A7%A3%E6%9E%90%E6%8C%87%E4%BB%A4%22%5D%0A%20%20Compiler%5B%22Compiler%5Cn%E8%A7%A3%E6%9E%90%E6%8C%87%E4%BB%A4%22%5D%20--%3E%7C%E5%88%9D%E5%A7%8B%E5%8C%96%E8%A7%86%E5%9B%BE%7C%20Updater((%22Updater%22))%0A%20%20Compiler%5B%22Compiler%5Cn%E8%A7%A3%E6%9E%90%E6%8C%87%E4%BB%A4%22%5D%20--%3E%7C%E8%AE%A2%E9%98%85%E6%95%B0%E6%8D%AE%E5%8F%98%E5%8C%96%2C%E7%BB%91%E5%AE%9A%E6%9B%B4%E6%96%B0%E5%87%BD%E6%95%B0%7C%20Watcher(%22Watcher%22)%0A%20%20Observer%5B%22Observer%5Cn%E5%8A%AB%E6%8C%81%E7%9B%91%E5%90%AC%E6%89%80%E6%9C%89%E5%B1%9E%E6%80%A7%22%5D%20--%3E%7C%E9%80%9A%E7%9F%A5%E5%8F%98%E5%8C%96%7C%20Dep((%22Dep%5Cn%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86%22))%0A%20%20Dep((%22Dep%5Cn%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86%22))%20--%3E%7C%E9%80%9A%E7%9F%A5%E5%8F%98%E5%8C%96%7C%20Watcher(%22Watcher%22)%0A%20%20Watcher(%22Watcher%22)%20--%3E%7C%E6%B7%BB%E5%8A%A0%E8%AE%A2%E9%98%85%E8%80%85%7C%20Dep((%22Dep%5Cn%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86%22))%0A%20%20Watcher(%22Watcher%22)%20--%3E%7C%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE%7C%20Updater((%22Updater%22))%0A"})]),_:1}),g,a(e,{id:"observer-example",class:"language-javascript line-numbers-mode","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"undefined",async:"undefined",content:"class%20Observer%20%7B%0A%20%20constructor(data)%20%7B%0A%20%20%20%20this.data%20%3D%20data%3B%0A%20%20%20%20this.init(data)%3B%0A%20%20%7D%0A%0A%20%20defineReactive(data%2C%20key%2C%20val)%20%7B%0A%20%20%20%20observe(val)%3B%20%2F%2F%20%E9%80%92%E5%BD%92%E7%9B%91%E5%90%AC%E5%AD%90%E5%B1%9E%E6%80%A7%0A%20%20%20%20Object.defineProperty(data%2C%20key%2C%20%7B%0A%20%20%20%20%20%20enumerable%3A%20true%2C%0A%20%20%20%20%20%20configurable%3A%20false%2C%0A%20%20%20%20%20%20get()%20%7B%0A%20%20%20%20%20%20%20%20return%20val%3B%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20set(newVal)%20%7B%0A%20%20%20%20%20%20%20%20console.log(%60detect%20change%3A%20%24%7Bval%7D%20--%3E%20%24%7BnewVal%7D%60)%3B%0A%20%20%20%20%20%20%20%20val%20%3D%20newVal%3B%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20init(data)%20%7B%0A%20%20%20%20Object.keys(data).forEach((key)%20%3D%3E%20%7B%0A%20%20%20%20%20%20this.defineReactive(data%2C%20key%2C%20data%5Bkey%5D)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%0A%0Afunction%20observe(data)%20%7B%0A%20%20if%20(!data%20%7C%7C%20typeof%20data%20!%3D%3D%20'object')%20return%3B%0A%20%20return%20new%20Observer(data)%3B%0A%7D%0A",ext:"javascript"},{default:t(()=>[x,_]),_:1}),F,a(e,{id:"observer-example1",class:"language-javascript line-numbers-mode","data-ext":"js",use_context:"observer-example","data-action":"run","data-use-context":"observer-example",fullscreen:"undefined",steps:"undefined",action:"run",winCtrl:"undefined",async:"undefined",content:"const%20foo%20%3D%20%7B%0A%20%20name%3A%20'Walter%20White'%2C%0A%20%20children%3A%20%5Bundefined%2C%20undefined%5D%2C%0A%7D%3B%0A%0Aobserve(foo)%3B%0Afoo.name%20%3D%20'Heisenberg'%3B%0A%2F%2F%20'detect%20change%3A%20Walter%20White%20--%3E%20Heisenberg'%0Afoo.children%5B0%5D%20%3D%20'Walter%20Junior'%3B%0A%2F%2F%20'detect%20change%3A%20undefined%20--%3E%20Walter%20Junior'%0A",ext:"javascript"},{default:t(()=>[V,j]),_:1}),O,N,a(e,{id:"observer-dep-example",class:"language-javascript line-numbers-mode","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"undefined",async:"undefined",content:"let%20uid%20%3D%200%3B%0Aclass%20Dep%20%7B%0A%20%20constructor()%20%7B%0A%20%20%20%20this.id%20%3D%20uid%2B%2B%3B%0A%20%20%20%20this.subscribers%20%3D%20%5B%5D%3B%0A%20%20%7D%0A%0A%20%20add(subscriber)%20%7B%0A%20%20%20%20this.subscribers.push(subscriber)%3B%0A%20%20%7D%0A%0A%20%20remove(subscriber)%20%7B%0A%20%20%20%20const%20index%20%3D%20this.subscribers.findIndex(subscriber)%3B%0A%20%20%20%20if%20(index%20!%3D%3D%20-1)%20%7B%0A%20%20%20%20%20%20this.subscribers.splice(index%2C%201)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20notify()%20%7B%0A%20%20%20%20this.subscribers.forEach((subscriber)%20%3D%3E%20%7B%0A%20%20%20%20%20%20subscriber.update()%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%0A%0Aclass%20Observer%20%7B%0A%20%20constructor(data)%20%7B%0A%20%20%20%20this.data%20%3D%20data%3B%0A%20%20%20%20this.init(data)%3B%0A%20%20%7D%0A%0A%20%20defineReactive(data%2C%20key%2C%20val)%20%7B%0A%20%20%20%20const%20dep%20%3D%20new%20Dep()%3B%0A%20%20%20%20observe(val)%3B%20%2F%2F%20%E9%80%92%E5%BD%92%E7%9B%91%E5%90%AC%E5%AD%90%E5%B1%9E%E6%80%A7%0A%20%20%20%20Object.defineProperty(data%2C%20key%2C%20%7B%0A%20%20%20%20%20%20enumerable%3A%20true%2C%0A%20%20%20%20%20%20configurable%3A%20false%2C%0A%20%20%20%20%20%20get()%20%7B%0A%20%20%20%20%20%20%20%20return%20val%3B%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20set(newVal)%20%7B%0A%20%20%20%20%20%20%20%20if%20(val%20%3D%3D%3D%20newVal)%20return%3B%0A%20%20%20%20%20%20%20%20console.log(%60detect%20change%3A%20%24%7Bval%7D%20--%3E%20%24%7BnewVal%7D%60)%3B%0A%20%20%20%20%20%20%20%20val%20%3D%20newVal%3B%0A%20%20%20%20%20%20%20%20dep.notify()%3B%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20init(data)%20%7B%0A%20%20%20%20Object.keys(data).forEach((key)%20%3D%3E%20%7B%0A%20%20%20%20%20%20this.defineReactive(data%2C%20key%2C%20data%5Bkey%5D)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%0A",ext:"javascript"},{default:t(()=>[W,M]),_:1}),U,a(e,{id:"observer-dep-example1",class:"language-javascript line-numbers-mode","data-ext":"js",use_context:"observer-example,observer-dep-example","data-action":"run","data-use-context":"observer-example,observer-dep-example",fullscreen:"undefined",steps:"undefined",action:"run",winCtrl:"undefined",async:"undefined",content:"const%20foo%20%3D%20%7B%0A%20%20name%3A%20'Walter%20White'%2C%0A%20%20children%3A%20%5Bundefined%2C%20undefined%5D%2C%0A%7D%3B%0A%0Aobserve(foo)%3B%0Afoo.name%20%3D%20'Heisenberg'%3B%0A%2F%2F%20'detect%20change%3A%20Walter%20White%20--%3E%20Heisenberg'%0Afoo.children%5B0%5D%20%3D%20'Walter%20Junior'%3B%0A%2F%2F%20'detect%20change%3A%20undefined%20--%3E%20Walter%20Junior'%0A",ext:"javascript"},{default:t(()=>[$,T]),_:1}),H,I,a(e,{id:"watcher-example",class:"language-javascript line-numbers-mode","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"undefined",async:"undefined",content:"class%20Watcher%20%7B%0A%20%20constructor(vm%2C%20expOrFn%2C%20cb)%20%7B%0A%20%20%20%20this.vm%20%3D%20vm%3B%0A%20%20%20%20this.expOrFn%20%3D%20expOrFn%3B%0A%20%20%20%20this.cb%20%3D%20cb%3B%0A%20%20%20%20this.depIds%20%3D%20%7B%7D%3B%0A%0A%20%20%20%20if%20(typeof%20expOrFn%20%3D%3D%3D%20'function')%20%7B%0A%20%20%20%20%20%20this.getter%20%3D%20expOrFn%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20this.getter%20%3D%20this.parseGetter(expOrFn.trim())%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20this.value%20%3D%20this.get()%3B%0A%20%20%7D%0A%0A%20%20update()%20%7B%0A%20%20%20%20this.run()%3B%0A%20%20%7D%0A%0A%20%20run()%20%7B%0A%20%20%20%20const%20value%20%3D%20this.get()%3B%0A%20%20%20%20const%20oldVal%20%3D%20this.value%3B%0A%20%20%20%20if%20(value%20!%3D%3D%20oldVal)%20%7B%0A%20%20%20%20%20%20this.value%20%3D%20value%3B%0A%20%20%20%20%20%20this.cb.call(this.vm%2C%20value%2C%20oldVal)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F**%0A%20%20%20*%20%E5%B0%86%E5%BD%93%E5%89%8D%E8%AE%A2%E9%98%85%E8%80%85%E6%8C%87%E5%90%91%E8%87%AA%E8%BA%AB%0A%20%20%20*%20%E8%A7%A6%E5%8F%91getter%EF%BC%8C%E5%B0%86%E8%87%AA%E5%B7%B1%E7%9A%84%E5%B1%9E%E6%80%A7%0A%20%20%20*%2F%0A%20%20get()%20%7B%0A%20%20%20%20Dep.target%20%3D%20this%3B%0A%20%20%20%20const%20value%20%3D%20this.getter.call(this.vm%2C%20this.vm)%3B%0A%20%20%20%20Dep.target%20%3D%20null%3B%0A%20%20%20%20return%20value%3B%0A%20%20%7D%0A%0A%20%20parseGetter(exp)%20%7B%0A%20%20%20%20if%20(%2F%5B%5E%5Cw.%24%5D%2F.test(exp))%20return%3B%0A%20%20%20%20const%20exps%20%3D%20exp.split('.')%3B%0A%20%20%20%20return%20(obj)%20%3D%3E%20%7B%0A%20%20%20%20%20%20for%20(let%20i%20%3D%200%2C%20len%20%3D%20exps.length%3B%20i%20%3C%20len%3B%20i%20%2B%3D%201)%20%7B%0A%20%20%20%20%20%20%20%20if%20(!obj)%20return%3B%0A%20%20%20%20%20%20%20%20obj%20%3D%20obj%5Bexps%5Bi%5D%5D%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20obj%3B%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%0A%20%20%2F**%0A%20%20%20*%20%E7%BB%B4%E6%8A%A4%E4%B8%80%E4%B8%AAdepIds%E7%94%A8%E6%9D%A5%E5%AD%98%E5%82%A8%E6%96%B0%E6%B7%BB%E5%8A%A0%E5%B1%9E%E6%80%A7%EF%BC%8C%E5%B9%B6%E4%B8%BA%E6%96%B0%E7%9A%84%E5%B1%9E%E6%80%A7%E5%A2%9E%E5%8A%A0%E6%96%B0%E7%9A%84setter%E4%B8%8Edep%EF%BC%8C%0A%20%20%20*%20%E5%B9%B6%E5%B0%86%E5%BD%93%E5%89%8Dwatcher%E5%8A%A0%E5%85%A5%E6%96%B0%E7%9A%84dep%E4%B8%AD%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%AF%B9%E5%BA%94%E7%9A%84watcher%E6%89%8D%E8%83%BD%E5%BE%97%E5%88%B0%E9%80%9A%E7%9F%A5%E3%80%82%0A%20%20%20*%20%40param%20%7BDep%7D%20dep%20%0A%20%20%20*%2F%0A%20%20addDep(dep)%20%7B%0A%20%20%20%20if%20(!this.depIds.hasOwnProperty(dep.id))%20%7B%0A%20%20%20%20%20%20dep.add(this)%3B%0A%20%20%20%20%20%20this.depIds%5Bdep.id%5D%20%3D%20dep%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A",ext:"javascript"},{default:t(()=>[P,L]),_:1}),R,S,a(u,null,{default:t(()=>[a(l,{id:"Compiler流程",no:"1-2",graph:"flowchart%20TD%0A%20%20Instance(%5B%22new%20Compiler()%22%5D)%20--%3E%7C%E8%A7%A3%E6%9E%90%E6%8C%87%E4%BB%A4%7C%20Step1(%5B%22%E6%A8%A1%E6%9D%BF%E6%8C%87%E4%BB%A4%E6%9B%BF%E6%8D%A2%E6%88%90%E5%AF%B9%E5%BA%94%E6%95%B0%E6%8D%AE%22%5D)%0A%20%20Step1(%5B%22%E6%A8%A1%E6%9D%BF%E6%8C%87%E4%BB%A4%E6%9B%BF%E6%8D%A2%E6%88%90%E5%AF%B9%E5%BA%94%E6%95%B0%E6%8D%AE%22%5D)%20--%3E%7C%E5%88%9D%E5%A7%8B%E5%8C%96%7C%20Updater((%22Updater%22))%0A%20%20Step1(%5B%22%E6%A8%A1%E6%9D%BF%E6%8C%87%E4%BB%A4%E6%9B%BF%E6%8D%A2%E6%88%90%E5%AF%B9%E5%BA%94%E6%95%B0%E6%8D%AE%22%5D)%20--%3E%7C%E7%BC%96%E8%AF%91%E6%8C%87%E4%BB%A4%7C%20Step2%5B%22new%20Updater()%5Cn%E7%9B%91%E5%90%AC%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BB%91%E5%AE%9A%E6%9B%B4%E6%96%B0%E5%87%BD%E6%95%B0%22%5D%0A%20%20Step2%5B%22new%20Updater()%5Cn%E7%9B%91%E5%90%AC%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BB%91%E5%AE%9A%E6%9B%B4%E6%96%B0%E5%87%BD%E6%95%B0%22%5D%20--%3E%7C%E6%95%B0%E6%8D%AE%E5%8F%98%E5%8C%96%E9%80%9A%E7%9F%A5%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE%7C%20Updater((%22Updater%22))%0A"})]),_:1}),a(e,{id:"compiler-example",class:"language-javascript line-numbers-mode","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"undefined",async:"undefined",content:"class%20Compiler%20%7B%0A%0A%20%20constructor(el%2C%20vm)%20%7B%0A%20%20%20%20this.%24vm%20%3D%20vm%3B%0A%20%20%20%20this.%24el%20%3D%20this.isElementNode(el)%20%3F%20el%20%3A%20document.querySelector(el)%3B%0A%20%20%20%20if%20(this.%24el)%20%7B%0A%20%20%20%20%20%20this.%24fragment%20%3D%20this.node2Fragment(this.%24el)%3B%0A%20%20%20%20%20%20this.init()%3B%0A%20%20%20%20%20%20this.%24el.appendChild(this.%24fragment)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20init()%20%7B%0A%20%20%20%20this.compileElement(this.%24fragment)%3B%0A%20%20%7D%0A%0A%20%20%2F**%0A%20%20%20*%20%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E5%8F%8A%E5%85%B6%E5%AD%90%E8%8A%82%E7%82%B9%EF%BC%8C%E6%89%AB%E6%8F%8F%E8%A7%A3%E6%9E%90%E7%BC%96%E8%AF%91%EF%BC%8C%0A%20%20%20*%20%E8%B0%83%E7%94%A8%E5%AF%B9%E5%BA%94%E6%8C%87%E4%BB%A4%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0%E6%B8%B2%E6%9F%93%E6%95%B0%E6%8D%AE%E5%B9%B6%E7%BB%91%E5%AE%9A%E5%AF%B9%E5%BA%94%E7%9A%84%E6%9B%B4%E6%96%B0%E5%87%BD%E6%95%B0%0A%20%20%20*%20%40param%20%7BElement%7D%20el%20%0A%20%20%20*%2F%0A%20%20compileElement(el)%20%7B%0A%20%20%20%20const%20childNodes%20%3D%20el.childNodes%3B%0A%20%20%20%20%5B%5D.slice.call(childNodes).forEach(node%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20text%20%3D%20node.textContent%3B%0A%20%20%20%20%20%20const%20reg%20%3D%20%2F%5C%7B%5C%7B(.*)%5C%7D%5C%7D%2F%3B%0A%20%20%20%20%20%20if%20(this.isElementNode(node))%20%7B%0A%20%20%20%20%20%20%20%20this.compile(node)%3B%0A%20%20%20%20%20%20%7D%20else%20if%20(this.isTextNode(node)%20%26%26%20reg.test(text))%20%7B%0A%20%20%20%20%20%20%20%20this.compileText(node%2C%20RegExp.%241.trim())%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20(node.childNodes%20%26%26%20node.childNodes.length)%20%7B%0A%20%20%20%20%20%20%20%20this.compileElement(node)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20compile(node)%20%7B%0A%20%20%20%20const%20nodeAttrs%20%3D%20node.attributes%3B%0A%20%20%20%20%5B%5D.slice.call(nodeAttrs).forEach(attr%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20attrName%20%3D%20attr.name%3B%0A%20%20%20%20%20%20if%20(this.isDirective(attrName))%20%7B%0A%20%20%20%20%20%20%20%20const%20exp%20%3D%20attr.value%3B%0A%20%20%20%20%20%20%20%20const%20dir%20%3D%20attrName.substring(2)%3B%0A%20%20%20%20%20%20%20%20if%20(this.isEventDirective(dir))%20%7B%0A%20%20%20%20%20%20%20%20%20%20Utils.eventHandler(node%2C%20this.%24vm%2C%20exp%2C%20dir)%3B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20Utils%5Bdir%5D%20%26%26%20Utils%5Bdir%5D(node%2C%20this.%24vm%2C%20exp)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20node.removeAttribute(attrName)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20node2Fragment(el)%20%7B%0A%20%20%20%20const%20fragment%20%3D%20document.createDocumentFragment()%3B%0A%20%20%20%20let%20child%20%3D%20el.firstChild%3B%0A%20%20%20%20while%20(child)%20%7B%0A%20%20%20%20%20%20fragment.appendChild(child)%3B%0A%20%20%20%20%20%20child%20%3D%20el.firstChild%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20fragment%3B%0A%20%20%7D%0A%0A%20%20compileText(node%2C%20exp)%20%7B%0A%20%20%20%20Utils.text(node%2C%20this.%24vm%2C%20exp)%3B%0A%20%20%7D%0A%0A%20%20isElementNode(node)%20%7B%0A%20%20%20%20return%20node.nodeType%20%3D%3D%3D%201%3B%0A%20%20%7D%0A%0A%20%20isTextNode(node)%20%7B%0A%20%20%20%20return%20node.nodeType%20%3D%3D%3D%203%3B%0A%20%20%7D%0A%0A%20%20isDirective(attr)%20%7B%0A%20%20%20%20return%20attr.startsWith('v-')%3B%0A%20%20%7D%0A%0A%20%20isEventDirective(dir)%20%7B%0A%20%20%20%20return%20dir.startsWith('on')%3B%0A%20%20%7D%0A%7D%0A%0Avar%20Utils%20%3D%20%7B%0A%20%20text(node%2C%20vm%2C%20exp)%20%7B%0A%20%20%20%20this.bind(node%2C%20vm%2C%20exp%2C%20'text')%3B%0A%20%20%7D%2C%0A%20%20html(node%2C%20vm%2C%20exp)%20%7B%0A%20%20%20%20this.bind(node%2C%20vm%2C%20exp%2C%20'html')%3B%0A%20%20%7D%2C%0A%20%20class(node%2C%20vm%2C%20exp)%20%7B%0A%20%20%20%20this.bind(node%2C%20vm%2C%20exp%2C%20'class')%3B%0A%20%20%7D%2C%0A%20%20model(node%2C%20vm%2C%20exp)%20%7B%0A%20%20%20%20this.bind(node%2C%20vm%2C%20exp%2C%20'model')%3B%0A%20%20%20%20let%20val%20%3D%20this._getVMVal(vm%2C%20exp)%3B%0A%20%20%20%20node.addEventListener('input'%2C%20e%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20newVal%20%3D%20e.target.value%3B%0A%20%20%20%20%20%20if%20(val%20%3D%3D%3D%20newVal)%20return%3B%0A%0A%20%20%20%20%20%20this._setVMVal(vm%2C%20exp%2C%20newVal)%3B%0A%20%20%20%20%20%20val%20%3D%20newVal%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%2C%0A%20%20bind(node%2C%20vm%2C%20exp%2C%20dir)%20%7B%0A%20%20%20%20const%20updaterFn%20%3D%20Updater%5B%60%24%7Bdir%7DUpdater%60%5D%3B%0A%20%20%20%20updaterFn%20%26%26%20updaterFn(node%2C%20this._getVMVal(vm%2C%20exp))%3B%0A%20%20%20%20new%20watchUserConfigFile(vm%2C%20exp%2C%20(value%2C%20oldVal)%20%3D%3E%20%7B%0A%20%20%20%20%20%20updaterFn%20%26%26%20updaterFn(node%2C%20value%2C%20oldVal)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%2C%0A%20%20eventHandler(node%2C%20vm%2C%20exp%2C%20dir)%20%7B%0A%20%20%20%20const%20eventType%20%3D%20dir.split('%3A')%5B1%5D%3B%0A%20%20%20%20const%20fn%20%3D%20vm.%24options.methods%20%26%26%20vm.%24options.methods%5Bexp%5D%3B%0A%20%20%20%20if%20(eventType%20%26%26%20fn)%20%7B%0A%20%20%20%20%20%20node.addEventListener(eventType%2C%20fn.bind(vm)%2C%20false)%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%20%20_getVMVal(vm%2C%20exp)%20%7B%0A%20%20%20%20let%20val%20%3D%20vm%3B%0A%20%20%20%20let%20exp%20%3D%20exp.split('.')%3B%0A%20%20%20%20exp.forEach(k%20%3D%3E%20val%20%3D%20val%5Bk%5D)%3B%0A%20%20%20%20return%20val%3B%0A%20%20%7D%2C%0A%20%20_setVMVal(vm%2C%20exp%2C%20value)%20%7B%0A%20%20%20%20let%20val%20%3D%20vm%3B%0A%20%20%20%20let%20exp%20%3D%20exp.split('.')%3B%0A%20%20%20%20exp.forEach((k%2C%20i)%20%3D%3E%20%7B%0A%20%20%20%20%20%20if%20(i%20%3C%20exp.length%20-%201)%20%7B%0A%20%20%20%20%20%20%20%20val%20%3D%20val%5Bk%5D%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20val%5Bk%5D%20%3D%20value%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%3B%0A%0Avar%20Updater%20%3D%20%7B%0A%20%20textUpdater(node%2C%20value)%20%7B%0A%20%20%20%20node.textContent%20%3D%20typeof%20value%20%3D%3D%3D%20'undefined'%20%3F%20''%20%3A%20value%3B%0A%20%20%7D%2C%0A%20%20htmlUpdater(node%2C%20value)%20%7B%0A%20%20%20%20node.innerHTML%20%3D%20typeof%20value%20%3D%3D%3D%20'undefined'%20%3F%20''%20%3A%20value%3B%0A%20%20%7D%2C%0A%20%20classUpdater(node%2C%20value%2C%20oldVal)%20%7B%0A%20%20%20%20let%20className%20%3D%20node.className%3B%0A%20%20%20%20className%20%3D%20className.replace(oldVal%2C%20'').replace(%2F%5Cs%24%2F%2C%20'')%3B%0A%20%20%20%20const%20space%20%3D%20className%20%26%26%20String(value)%20%3F%20'%20'%20%3A%20''%3B%0A%20%20%20%20node.className%20%3D%20className%20%2B%20space%20%2B%20value%3B%0A%20%20%7D%2C%0A%20%20modelUpdater(node%2C%20value%2C%20oldVal)%20%7B%0A%20%20%20%20node.value%20%3D%20typeof%20value%20%3D%3D%3D%20'undefined'%20%3F%20''%20%3A%20value%3B%0A%20%20%7D%0A%7D%3B%0A",ext:"javascript"},{default:t(()=>[J,G]),_:1}),q,a(e,{id:"mvvm-example",class:"language-javascript line-numbers-mode","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"undefined",async:"undefined",content:"class%20MVVM%20%7B%0A%20%20constructor(options%20%3D%20%7B%7D)%20%7B%0A%20%20%20%20this.%24options%20%3D%20options%3B%0A%20%20%20%20this._data%20%3D%20this.%24options.data%3B%0A%20%20%20%20const%20data%20%3D%20this._data%3B%0A%20%20%20%20Object.keys(data).forEach(key%20%3D%3E%20%7B%0A%20%20%20%20%20%20this._proxyData(key)%3B%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20this._initComputed()%3B%0A%0A%20%20%20%20observe(data%2C%20this)%3B%0A%0A%20%20%20%20this.%24compiler%20%3D%20new%20Compiler(options.el%20%7C%7C%20document.body%2C%20this)%3B%0A%20%20%7D%0A%0A%20%20%2F**%0A%20%20%20*%20%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86%E6%96%B9%E6%B3%95%EF%BC%8C%E5%B0%86_data%E4%B8%AD%E7%9A%84%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86%E5%88%B0this%E6%9C%AC%E8%BA%AB%EF%BC%8C%E6%96%B9%E4%BE%BF%E8%AE%BF%E9%97%AE%E3%80%82%0A%20%20%20*%20%40param%20%7Bstring%7D%20key%20%0A%20%20%20*%20%40param%20%7B()%20%3D%3E%20void%7D%20setter%20%0A%20%20%20*%2F%0A%20%20_proxyData(key%2C%20setter)%20%7B%0A%20%20%20%20const%20_this%20%3D%20this%3B%0A%20%20%20%20setter%20%3D%20setter%20%7C%7C%20Object.defineProperty(this%2C%20key%2C%20%7B%0A%20%20%20%20%20%20enumerable%3A%20true%2C%0A%20%20%20%20%20%20configurable%3A%20false%2C%0A%20%20%20%20%20%20get()%20%7B%0A%20%20%20%20%20%20%20%20return%20_this._data%5Bkey%5D%3B%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20set(newVal)%20%7B%0A%20%20%20%20%20%20%20%20this._data%5Bkey%5D%20%3D%20newVal%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%0A%20%20_initComputed()%20%7B%0A%20%20%20%20const%20computed%20%3D%20this.%24options.computed%3B%0A%20%20%20%20if%20(typeof%20computed%20%3D%3D%3D%20'object')%20%7B%0A%20%20%20%20%20%20Object.keys(computed).forEach(key%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20Object.defineProperty(this%2C%20key%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20get%3A%20typeof%20computed%5Bkey%5D%20%3D%3D%3D%20'function'%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20computed%5Bkey%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%20computed%5Bkey%5D.get%2C%0A%20%20%20%20%20%20%20%20%20%20set()%20%7B%20%7D%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%24watch(key%2C%20cb)%20%7B%0A%20%20%20%20new%20Watcher(this%2C%20key%2C%20cb)%3B%0A%20%20%7D%0A%7D%0A",ext:"javascript"},{default:t(()=>[Q,X]),_:1}),z,K,a(i),Y,Z,a(k)])}const en=r(v,[["render",nn],["__file","index.html.vue"]]);export{en as default};
