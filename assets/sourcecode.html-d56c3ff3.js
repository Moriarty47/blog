import{_ as l,M as p,p as u,q as i,N as a,V as o,Q as n,t as s,a0 as e}from"./framework-5411b43d.js";const r="/blog/assets/webpack-flow-437bfdd4.png",k="/blog/assets/moduleFactory-6d44cf40.png",d="/blog/assets/module-64ae8693.png",A={},g=e('<h2 id="webpack-源码分析" tabindex="-1"><a class="header-anchor" href="#webpack-源码分析" aria-hidden="true">#</a> Webpack 源码分析</h2><p>可将其理解为一种基于事件流的编程范例，一系列的插件运行。</p><h3 id="webpack-命令" tabindex="-1"><a class="header-anchor" href="#webpack-命令" aria-hidden="true">#</a> <code>webpack</code> 命令</h3><ul><li>通过 npm scripts 运行 webpack</li></ul><p><code>npm run dev</code> <code>npm run build</code></p><ul><li>通过 webpack 直接运行</li></ul><p><code>webpack entry.js bundle.js</code></p><p>命令行运行以上命令后，npm 会 让命令行工具进入 <code>node_modules\\.bin</code> 目录 查找是否存在 <code>webpack.sh</code> 或者 <code>webpack.cmd</code> 或者 <code>webpack.ps1</code> 文件，如果存在，就执行，不存在，抛出错误。</p><p>实际入口文件是 <code>node_modules\\webpack\\bin\\webpack.js</code></p>',9),m=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// 1. 正常执行返回"),s(`
process`),n("span",{class:"token punctuation"},"."),s("exitCode "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 2. 运行某个命令"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token function-variable function"},"runCommand"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("command"),n("span",{class:"token punctuation"},","),s(" args")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 3. 判断某个包是否安装"),s(`
`),n("span",{class:"token keyword"},"const"),s(" isInstalled "),n("span",{class:"token operator"},"="),s(" packageName "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 4. webpack可用的CLI：webpack-cli和webpack-command"),s(`
`),n("span",{class:"token keyword"},"const"),s(" CLIs "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 5. 过滤安装过的CLI"),s(`
`),n("span",{class:"token keyword"},"const"),s(" installedClis "),n("span",{class:"token operator"},"="),s(" CLIs"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"filter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"cli"),s(),n("span",{class:"token operator"},"=>"),s(" cli"),n("span",{class:"token punctuation"},"."),s("installed"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 6. 根据安装数量进行处理"),s(`
`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("installedClis"),n("span",{class:"token punctuation"},"."),s("length "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("installedClis"),n("span",{class:"token punctuation"},"."),s("length "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token comment"},"// 7. 中途报错退出"),s(`
process`),n("span",{class:"token punctuation"},"."),s("exitCode "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),h=e('<p><code>webpack</code> 最终找到 <code>webpack-cli</code> / <code>webpack-command</code> 包，并执行 CLI。</p><h3 id="webpack-cli-命令" tabindex="-1"><a class="header-anchor" href="#webpack-cli-命令" aria-hidden="true">#</a> <code>webpack-cli</code> 命令</h3><ul><li>引入 yargs，对命令行进行定制</li><li>分析命令行参数，对各个参数进行转换，组成编译配置项</li><li>引入 webpack，根据配置项进行编译和构建</li></ul><h4 id="从-non-compilation-cmd-分析出不需要编译的命令" tabindex="-1"><a class="header-anchor" href="#从-non-compilation-cmd-分析出不需要编译的命令" aria-hidden="true">#</a> 从 NON_COMPILATION_CMD 分析出不需要编译的命令</h4><p>webpack-cli 处理不需要经过编译的命令</p>',5),f=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},`/* const NON_COMPILATION_ARGS = [
	"init",              // 创建一份 webpack 配置文件
	"migrate",           // 进行webpack版本迁移
	"add",               // 向webpack配置文件中增加属性
	"remove",            // 向webpack配置文件中删除属性
	"serve",             // 运行webpack-serve
	"generate-loader",   // 生成webpack-loader代码
	"generate-plugin",   // 生成webpack-plugin代码
	"info"               // 返回与本地环境相关的一些信息
]; */`),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token constant"},"NON_COMPILATION_ARGS"),s(),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"./utils/constants"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token constant"},"NON_COMPILATION_CMD"),s(),n("span",{class:"token operator"},"="),s(" process"),n("span",{class:"token punctuation"},"."),s("argv"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"find"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"arg"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("arg "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},'"serve"'),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    global`),n("span",{class:"token punctuation"},"."),s("process"),n("span",{class:"token punctuation"},"."),s("argv "),n("span",{class:"token operator"},"="),s(" global"),n("span",{class:"token punctuation"},"."),s("process"),n("span",{class:"token punctuation"},"."),s("argv"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"filter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"a"),s(),n("span",{class:"token operator"},"=>"),s(" a "),n("span",{class:"token operator"},"!=="),s(),n("span",{class:"token string"},'"serve"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    process`),n("span",{class:"token punctuation"},"."),s("argv "),n("span",{class:"token operator"},"="),s(" global"),n("span",{class:"token punctuation"},"."),s("process"),n("span",{class:"token punctuation"},"."),s("argv"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token constant"},"NON_COMPILATION_ARGS"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"find"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"a"),s(),n("span",{class:"token operator"},"=>"),s(" a "),n("span",{class:"token operator"},"==="),s(" arg"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"NON_COMPILATION_CMD"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"./utils/prompt-command"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),n("span",{class:"token constant"},"NON_COMPILATION_CMD"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token operator"},"..."),s("process"),n("span",{class:"token punctuation"},"."),s("argv"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`)])],-1),B=e('<p>webpack-cli 对配置文件和命令行参数进行转换最终生成配置选项参数 options，最终会根据配置参数实例化 webpack 对象，然后执行构建流程</p><h4 id="yargs-工具包" tabindex="-1"><a class="header-anchor" href="#yargs-工具包" aria-hidden="true">#</a> <code>yargs</code> 工具包</h4><p>提供命令和分组参数，动态生成 help 帮助信息</p><p>webpack-cli 使用 args 分析 参数数组(<code>config/config-args.js</code>)，将命令划分为 9 类：</p><ul><li>Config options：配置相关参数（文件名称、运行环境等）</li><li>Basic options：基础参数（entry 设置、debug 模式设置、watch 监听设置、devtool 设置）</li><li>Module options：模块参数，给 loader 设置扩展</li><li>Output options：输出参数（输出路径、输出文件名称）</li><li>Advanced options：高级用法（记录设置、缓存设置、监听频率、bail 等）</li><li>Resolving options：解析参数（alias 和解析的文件后缀设置）</li><li>Optimizing options：优化参数</li><li>Stats options：统计参数</li><li>options：通用参数（帮助命令、版本信息等）</li></ul><h3 id="tapable" tabindex="-1"><a class="header-anchor" href="#tapable" aria-hidden="true">#</a> <code>Tapable</code></h3><p>类似于 Node.js 的 EventEmitter 的库，主要是控制钩子函数的发布与订阅，控制着 webpack 的插件系统。</p><p>Tapable 库暴露了很多 Hook 类，为插件提供挂载的钩子</p>',8),y=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(`
  SyncHook`),n("span",{class:"token punctuation"},","),s("                 "),n("span",{class:"token comment"},"// 同步钩子"),s(`
  SyncBailHook`),n("span",{class:"token punctuation"},","),s("             "),n("span",{class:"token comment"},"// 同步熔断钩子"),s(`
  SyncWaterfallHook`),n("span",{class:"token punctuation"},","),s("        "),n("span",{class:"token comment"},"// 同步流水钩子"),s(`
  SyncLoopHook`),n("span",{class:"token punctuation"},","),s("             "),n("span",{class:"token comment"},"// 同步循环钩子"),s(`
  AsyncParallelHook`),n("span",{class:"token punctuation"},","),s("        "),n("span",{class:"token comment"},"// 异步并发钩子"),s(`
  AsyncParallelBailHook`),n("span",{class:"token punctuation"},","),s("    "),n("span",{class:"token comment"},"// 异步并发熔断钩子"),s(`
  AsyncSeriesHook`),n("span",{class:"token punctuation"},","),s("          "),n("span",{class:"token comment"},"// 异步串行钩子"),s(`
  AsyncSeriesBailHook`),n("span",{class:"token punctuation"},","),s("      "),n("span",{class:"token comment"},"// 异步串行熔断钩子"),s(`
  AsyncSeriesWaterfallHook  `),n("span",{class:"token comment"},"// 异步串行流水钩子"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'tapable'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),E=e('<h4 id="tapable-hooks-类型" tabindex="-1"><a class="header-anchor" href="#tapable-hooks-类型" aria-hidden="true">#</a> Tapable Hooks 类型</h4><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">Hook</td><td style="text-align:left;">所有钩子的后缀</td></tr><tr><td style="text-align:left;">Waterfall</td><td style="text-align:left;">同步方法，但是会传值给下一个函数</td></tr><tr><td style="text-align:left;">Bail</td><td style="text-align:left;">熔断：当函数有任何返回值，就会在当前执行函数停止</td></tr><tr><td style="text-align:left;">Loop</td><td style="text-align:left;">监听函数返回 true 表示继续循环，返回 undefined 表示结束循环</td></tr><tr><td style="text-align:left;">Sync</td><td style="text-align:left;">同步方法</td></tr><tr><td style="text-align:left;">AsyncSeries</td><td style="text-align:left;">异步串行钩子</td></tr><tr><td style="text-align:left;">AsyncParallel</td><td style="text-align:left;">异步并行执行钩子</td></tr></tbody></table><h4 id="new-hook-新建钩子" tabindex="-1"><a class="header-anchor" href="#new-hook-新建钩子" aria-hidden="true">#</a> <code>new Hook</code> 新建钩子</h4><p>Tapable 暴露出来的都是类方法，new 一个类方法获得我们需要的钩子。</p><p>class 接收数组参数 options，非必传，类方法会根据传参，接收同样数量的参数。</p><p><code>const hook1 = new SyncHook([&#39;arg1&#39;, &#39;arg2&#39;, &#39;arg3&#39;]);</code></p><h4 id="钩子的绑定与执行" tabindex="-1"><a class="header-anchor" href="#钩子的绑定与执行" aria-hidden="true">#</a> 钩子的绑定与执行</h4><p>Tapable 提供了同步和异步绑定钩子的方法，并且它们都有绑定事件和执行事件对应的方法。</p><table><thead><tr><th style="text-align:left;">Sync*</th><th style="text-align:left;">Async*</th></tr></thead><tbody><tr><td style="text-align:left;">绑定：tap</td><td style="text-align:left;">绑定：tapAsync / tapPromise / tap</td></tr><tr><td style="text-align:left;">执行：call</td><td style="text-align:left;">执行：callAsync / promise</td></tr></tbody></table><h4 id="示例" tabindex="-1"><a class="header-anchor" href="#示例" aria-hidden="true">#</a> 示例</h4><p>示例 1：</p>',11),b=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" hook1 "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"SyncHook"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},"'arg1'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'arg2'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'arg3'"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 绑定实践到 webpack 事件流"),s(`
hook1`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"tap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'hook1'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("arg1"),n("span",{class:"token punctuation"},","),s(" arg2"),n("span",{class:"token punctuation"},","),s(" arg3")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),s("arg1"),n("span",{class:"token punctuation"},","),s(" arg2"),n("span",{class:"token punctuation"},","),s(" arg3"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 执行绑定事件"),s(`
`),n("span",{class:"token function"},"hook1"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"2"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"3"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),w=n("p",null,"示例 2：",-1),D=n("p",null,"定义一个 Car 方法，在内部 hooks 上新建钩子。分别是同步钩子 accelerate，brake(accelerate 接收一个参数)，异步钩子 calculateRoutes；",-1),C=n("p",null,"使用钩子对应的绑定和执行方法",-1),_=n("p",null,"calculateRoutes 使用 tapPromise 可以返回一个 promise 对象",-1),F=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" SyncHook"),n("span",{class:"token punctuation"},","),s(" AsyncSeriesHook "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'tapable'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Car"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("hooks "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token literal-property property"},"accelerate"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"SyncHook"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},"'newspeed'"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token literal-property property"},"brake"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"SyncHook"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
      `),n("span",{class:"token literal-property property"},"calculateRoutes"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"AsyncSeriesHook"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},"'source'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'target'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'routesList'"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token keyword"},"const"),s(" myCar "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Car"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

myCar`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),s("brake"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"tap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'WarningLampPlugin'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(" console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'WarningLampPlugin'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

myCar`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),s("accelerate"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"tap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'LoggerPlugin'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token parameter"},"newSpeed"),s(),n("span",{class:"token operator"},"=>"),s(" console"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"Accelerating to "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("newSpeed"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

myCar`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),s("calculateRoutes"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"tapPromise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'calcuateRoutes tapPromise'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("source"),n("span",{class:"token punctuation"},","),s(" target"),n("span",{class:"token punctuation"},","),s(" routesList"),n("span",{class:"token punctuation"},","),s(" callback")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'source'"),n("span",{class:"token punctuation"},","),s(" source"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Promise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("resolve"),n("span",{class:"token punctuation"},","),s(" reject")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token function"},"setTimeout"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"tapPromise to "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("source"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("target"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("routesList"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token function"},"resolve"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

myCar`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"brake"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
myCar`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"accelerate"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"time"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'cost'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

myCar`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),s("calculateRoutes"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"promise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Async'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'Hook'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'Demo'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"timeEnd"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'cost'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token parameter"},"err"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"timeEnd"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'cost'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),x=n("h4",{id:"tapable-与-webpack-的联系",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#tapable-与-webpack-的联系","aria-hidden":"true"},"#"),s(" Tapable 与 Webpack 的联系")],-1),v=n("br",null,null,-1),j=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"let"),s(" compiler"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("Array"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isArray"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  compiler `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"MultiCompiler"),n("span",{class:"token punctuation"},"("),s(`
    Array`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"from"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"map"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"options"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token function"},"webpack"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"typeof"),s(" options "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},'"object"'),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  options `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"WebpackOptionsDefaulter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"process"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  compiler `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Compiler"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},"."),s("context"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  compiler`),n("span",{class:"token punctuation"},"."),s("options "),n("span",{class:"token operator"},"="),s(" options"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"NodeEnvironmentPlugin"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token literal-property property"},"infrastructureLogging"),n("span",{class:"token operator"},":"),s(" options"),n("span",{class:"token punctuation"},"."),s(`infrastructureLogging
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),s("compiler"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},"."),s("plugins "),n("span",{class:"token operator"},"&&"),s(" Array"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isArray"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},"."),s("plugins"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"const"),s(" plugin "),n("span",{class:"token keyword"},"of"),s(" options"),n("span",{class:"token punctuation"},"."),s("plugins"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"typeof"),s(" plugin "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token string"},'"function"'),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"plugin"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),s("compiler"),n("span",{class:"token punctuation"},","),s(" compiler"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token function"},"plugin"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),s("compiler"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  compiler`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"environment"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  compiler`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"afterEnvironment"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"call"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  compiler`),n("span",{class:"token punctuation"},"."),s("options "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"WebpackOptionsApply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"process"),n("span",{class:"token punctuation"},"("),s("options"),n("span",{class:"token punctuation"},","),s(" compiler"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"throw"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Invalid argument: options"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])],-1),S=e('<h3 id="webpack-流程" tabindex="-1"><a class="header-anchor" href="#webpack-流程" aria-hidden="true">#</a> Webpack 流程</h3><p>webpack 的编译都按照下面的钩子调用顺序执行：</p><p><img src="'+r+'" alt="webpack 流程"></p><h4 id="初始化阶段" tabindex="-1"><a class="header-anchor" href="#初始化阶段" aria-hidden="true">#</a> 初始化阶段</h4><p><code>WebpackOptionsApply.js</code> 将所有的配置 options 参数转换成 webpack 内部插件 使用默认插件列表，如：</p><ul><li>output.library -&gt; LibraryTemplatePlugin</li><li>externals -&gt; ExternalsPlugin</li><li>devtool -&gt; EvalDevtoolModulePlugin, SourceMapDevToolPlugin</li><li>AMDPlugin, CommonJsPlugin</li><li>RemoveEmptyChunksPlugin</li></ul><h4 id="模块构建和-chunk-生成阶段" tabindex="-1"><a class="header-anchor" href="#模块构建和-chunk-生成阶段" aria-hidden="true">#</a> 模块构建和 chunk 生成阶段</h4><p><code>Compiler Hooks</code></p><ul><li>流程相关 <ul><li>(before-)run</li><li>(before-/after-)compile</li><li>make</li><li>(after-)emit</li><li>done</li></ul></li><li>监听相关 <ul><li>watch-run</li><li>watch-close</li></ul></li></ul><p><code>Compilation</code></p><p>Compiler 调用 Compilation 生命周期方法</p><ul><li>addEntry -&gt; addModuleChain</li><li>finish(上报模块错误)</li><li>seal</li></ul><p><code>Compilation Hooks</code></p><ul><li>模块相关 <ul><li>build-module</li><li>failed-module</li><li>succeed-module</li></ul></li><li>资源生成相关 <ul><li>module-asset</li><li>chunk-asset</li></ul></li><li>优化和 seal 相关 <ul><li>(after-)seal</li><li>optimize</li><li>optimize-modules(-basic/advanced)</li><li>after-optimize-(modules/chunks/tree)</li><li>optimize-chunk-modules(-basic/advanced)</li><li>after-optimize-chunk-modules</li><li>optimize-module/chunk-order</li><li>before-module/chunk-ids</li><li>(after-)optimize-module/chunk-ids</li><li>before/after-hash</li></ul></li></ul><p><code>ModuleFactory</code></p><center><p><img src="'+k+'" alt="ModuleFactory"></p></center><p><code>Module</code></p><center><p><img src="'+d+'" alt="Module"></p></center><p><code>NormalModule</code></p><p><code>Build</code> 方法</p><ul><li>使用 loader-runner 运行 loaders</li><li>通过 Parser 解析(内部使用 acron)</li><li>ParserPlugins 添加依赖</li></ul><h4 id="chunk-生成算法" tabindex="-1"><a class="header-anchor" href="#chunk-生成算法" aria-hidden="true">#</a> Chunk 生成算法</h4><ol><li>webpack 先将 entry 中对应的 module 都生成一个新的 chunk；</li><li>遍历 module 的依赖列表，将依赖的 module 也加入到 chunk 中；</li><li>如果一个依赖 module 是动态引入的模块，则会根据这个 module 创建一个新的 chunk，继续遍历依赖；</li><li>重复上面的过程，直到得到所有的 chunks。</li></ol><h4 id="emit-文件生成阶段" tabindex="-1"><a class="header-anchor" href="#emit-文件生成阶段" aria-hidden="true">#</a> emit 文件生成阶段</h4><p>addEntry -&gt; _addModuleChain -&gt; buildModule -&gt; module.build -&gt; runLoader(内容转化) -&gt; Parser 依赖分析 -&gt; compile -&gt; compilation.seal(资源优化) -&gt; createHash/modifyHash -&gt; createModuleAssets -&gt; emitAsset 资源对象生成 -&gt; compiler emitAssets -&gt; hooks.emit -&gt; outputFileSystem.mkdirp</p><h3 id="实现简易-webpack" tabindex="-1"><a class="header-anchor" href="#实现简易-webpack" aria-hidden="true">#</a> 实现简易 Webpack</h3><p>增强代码的可读性和维护性</p><ul><li>传统网页开发转变成 Web Apps 开发</li><li>代码复杂度在逐步提高</li><li>分离的 JS 文件/模块，便于后续代码的维护性</li><li>部署时希望把代码优化成几个 HTTP 请求</li></ul><p>常见的几种模块化方式</p><ul><li>ES module</li><li>CJS</li><li>AMD</li></ul>',30),P={href:"https://esprima.org/demo/parse.html",target:"_blank",rel:"noopener noreferrer"},N=e('<div class="custom-container tip"><p class="custom-container-title">提示</p><ul><li>可以将 ES6 语法转换成 ES5 语法 <ul><li>通过 babylon 生成 AST</li><li>通过 babel-core 将 AST 重新生成源码</li></ul></li><li>可以分析模块之间的依赖关系 <ul><li>通过 babel-traverse 的 ImportDeclaration 方法获取依赖属性</li></ul></li><li>生成的 JS 文件可以在浏览器中运行</li><li>基本组成 <ul><li>config.js <ul><li><code>options</code> 提供 options，相当于 webpack 中的 webpack.config.js <ul><li><code>entry</code> 配置</li><li><code>output</code> 配置</li></ul></li></ul></li><li>index.js <ul><li><code>new Compiler(options).run()</code></li></ul></li><li>compiler.js <ul><li><code>class Compiler</code><ul><li><code>run()</code></li><li><code>buildModule(filename, isEntry)</code> 构建 modules</li><li><code>emitFiles()</code> 输出编译后文件</li></ul></li></ul></li><li>parser.js <ul><li><code>getAST(path)</code> 解析 AST 树</li><li><code>getDependencies(ast)</code> 从 entry 解析依赖</li><li><code>transform(ast)</code> 将 AST 重新生成 ES5 源码</li></ul></li></ul></li></ul></div><h3 id="loader-的链式调用和执行顺序" tabindex="-1"><a class="header-anchor" href="#loader-的链式调用和执行顺序" aria-hidden="true">#</a> loader 的链式调用和执行顺序</h3><p>loader 只是一个导出为函数的 JS 模块。</p><h4 id="多-loader-执行顺序" tabindex="-1"><a class="header-anchor" href="#多-loader-执行顺序" aria-hidden="true">#</a> 多 loader 执行顺序</h4><p>从后到前，串行执行</p>',5),H=n("pre",{class:"language-javascript"},[n("code",null,[s("module"),n("span",{class:"token punctuation"},"."),s("exports "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token literal-property property"},"module"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token literal-property property"},"rules"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),s(`
      `),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token literal-property property"},"test"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token regex"},[n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-source language-regex"},"\\.less$"),n("span",{class:"token regex-delimiter"},"/")]),n("span",{class:"token punctuation"},","),s(`
        `),n("span",{class:"token literal-property property"},"use"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},"'style-loader'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'css-loader'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'less-loader'"),n("span",{class:"token punctuation"},"]"),s(`
        `),n("span",{class:"token comment"},"// 执行顺序: 3 <- 2 <- 1"),s(`
      `),n("span",{class:"token punctuation"},"}"),s(`
    `),n("span",{class:"token punctuation"},"]"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),L=e('<div class="custom-container tip"><p class="custom-container-title">提示</p><p>函数组合的两种情况</p><ul><li><p>Unix 中的 pipeline</p></li><li><p>Compose(Webpack 采用)</p><p><code>const compose = (f, g) =&gt; (...args) =&gt; f(g(...args));</code></p></li></ul></div><h4 id="loader-runner" tabindex="-1"><a class="header-anchor" href="#loader-runner" aria-hidden="true">#</a> loader-runner</h4><p>允许你在不安装 webpack 的条件下运行 loaders</p><p>作用：</p><ul><li>作为 webpack 的依赖，webpack 中使用它来执行 loader</li><li>进行 loader 的开发和调试</li></ul>',5),O=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token punctuation"},"{"),s(" runLoaders "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"from"),s(),n("span",{class:"token string"},"'loader-runner'"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token function"},"runLoaders"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// String 资源的绝对路径（可以增加查询字符串）"),s(`
  `),n("span",{class:"token literal-property property"},"resource"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'/abs/path/to/file.txt?query'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token comment"},"// String[] loader的绝对路径（可以增加查询字符串）"),s(`
  `),n("span",{class:"token literal-property property"},"loaders"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'/abs/path/to/loader.js?query'"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token comment"},"// 基础上下文之外的额外loader上下文"),s(`
  `),n("span",{class:"token literal-property property"},"context"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"minimize"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(`
  `),n("span",{class:"token comment"},"// 读取资源的函数"),s(`
  `),n("span",{class:"token literal-property property"},"readResource"),n("span",{class:"token operator"},":"),s(" fs"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"readFile"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"bind"),n("span",{class:"token punctuation"},"("),s("fs"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"function"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("err"),n("span",{class:"token punctuation"},","),s(" result")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// err: Error?"),s(`
  `),n("span",{class:"token comment"},"// result.result: Buffer | String"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),I=n("h4",{id:"loader-参数获取",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#loader-参数获取","aria-hidden":"true"},"#"),s(" loader 参数获取")],-1),z=n("p",null,"通过 loader-utils 的 getOptions 方法获取参数",-1),M=n("h4",{id:"loader-异常处理",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#loader-异常处理","aria-hidden":"true"},"#"),s(" loader 异常处理")],-1),R=n("li",null,[n("p",null,"loader 内直接通过 throw 抛出")],-1),T=n("p",null,"通过 this.callback 传递错误",-1),q=n("pre",{class:"language-typescript"},[n("code",null,[n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"callback"),n("span",{class:"token punctuation"},"("),s(`
  err`),n("span",{class:"token operator"},":"),s(" Error "),n("span",{class:"token operator"},"|"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},","),s(`
  content`),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"string"),s(),n("span",{class:"token operator"},"|"),s(" Buffer"),n("span",{class:"token punctuation"},","),s(`
  sourceMap`),n("span",{class:"token operator"},"?"),n("span",{class:"token operator"},":"),s(" SourceMap"),n("span",{class:"token punctuation"},","),s(`
  meta`),n("span",{class:"token operator"},"?"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token builtin"},"any"),s(`
`),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),W=n("h4",{id:"loader-异步处理",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#loader-异步处理","aria-hidden":"true"},"#"),s(" loader 异步处理")],-1),J=n("p",null,"通过 this.async 返回一个异步函数",-1),$=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" callback "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"async"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("callback"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// ..."),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token function"},"callback"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},","),s(" result"),n("span",{class:"token punctuation"},")"),s(`
`)])],-1),Z=e('<h4 id="loader-缓存" tabindex="-1"><a class="header-anchor" href="#loader-缓存" aria-hidden="true">#</a> loader 缓存</h4><p>webpack 默认开启 loader 缓存，使用 <code>this.cacheable(false)</code> 关闭。</p><p>缓存条件：loader 的结果在相同的输入下有确定的输出。有依赖的 loader 无法使用缓存。</p><h4 id="loader-文件输出" tabindex="-1"><a class="header-anchor" href="#loader-文件输出" aria-hidden="true">#</a> loader 文件输出</h4><p>通过 this.emitFile 进行文件写入</p><h4 id="自动合成雪碧图-loader" tabindex="-1"><a class="header-anchor" href="#自动合成雪碧图-loader" aria-hidden="true">#</a> 自动合成雪碧图 loader</h4><p>将 <code>background: url(&#39;a.png?__sprite&#39;);</code> 和 <code>background: url(&#39;b.png?__sprite&#39;);</code> 转换为 <code>background: url(&#39;sprite.png&#39;);</code></p>',7),G={href:"https://github.com/twolfson/spritesmith",target:"_blank",rel:"noopener noreferrer"},V=n("p",null,[n("strong",null,"关键处理逻辑")],-1),Q=n("p",null,"通过匹配获取对应后缀的路径进行路径解析，再传递给 Spritesmith 处理",-1),U=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" fs "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'fs'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(" path "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'path'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(" Spritesmith "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'spritesmith'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

module`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function-variable function"},"exports"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"function"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"source"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" callback "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"async"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" imgs "),n("span",{class:"token operator"},"="),s(" source"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"match"),n("span",{class:"token punctuation"},"("),n("span",{class:"token regex"},[n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-source language-regex"},"url\\((\\S*)\\?__sprite"),n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-flags"},"g")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token keyword"},"const"),s(" matchedImgs "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"let"),s(" i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"<"),s(" imgs"),n("span",{class:"token punctuation"},"."),s("length"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"const"),s(" img "),n("span",{class:"token operator"},"="),s(" imgs"),n("span",{class:"token punctuation"},"["),s("i"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"match"),n("span",{class:"token punctuation"},"("),n("span",{class:"token regex"},[n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-source language-regex"},"url\\((\\S*)\\?__sprite"),n("span",{class:"token regex-delimiter"},"/")]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"["),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
    matchedImgs`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),s("path"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"join"),n("span",{class:"token punctuation"},"("),s("__dirname"),n("span",{class:"token punctuation"},","),s(" img"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  Spritesmith`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"run"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"src"),n("span",{class:"token operator"},":"),s(" matchedImgs "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("err"),n("span",{class:"token punctuation"},","),s(" result")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    fs`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"writeFileSync"),n("span",{class:"token punctuation"},"("),s("path"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"join"),n("span",{class:"token punctuation"},"("),s("process"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"cwd"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'dist/sprite.jpg'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" result"),n("span",{class:"token punctuation"},"."),s("image"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),s("result"),n("span",{class:"token punctuation"},"."),s("coordinates"),n("span",{class:"token punctuation"},","),s(" result"),n("span",{class:"token punctuation"},"."),s("properties"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    source `),n("span",{class:"token operator"},"="),s(" source"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"replace"),n("span",{class:"token punctuation"},"("),n("span",{class:"token regex"},[n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-source language-regex"},"url\\((\\S*)\\?__sprite\\)"),n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-flags"},"g")]),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("match"),n("span",{class:"token punctuation"},","),s(" $0")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" filePath "),n("span",{class:"token operator"},"="),s(" path"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"join"),n("span",{class:"token punctuation"},"("),s("__dirname"),n("span",{class:"token punctuation"},","),s(" $0"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" x"),n("span",{class:"token punctuation"},","),s(" y"),n("span",{class:"token punctuation"},","),s(" width"),n("span",{class:"token punctuation"},","),s(" height "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(" result"),n("span",{class:"token punctuation"},"."),s("coordinates"),n("span",{class:"token punctuation"},"["),s("filePath"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},'url("dist/sprite.jpg");\\n  background-position: '),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("x"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"px "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("y"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"px;\\n  background-size: "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("width"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"px "),n("span",{class:"token interpolation"},[n("span",{class:"token interpolation-punctuation punctuation"},"${"),s("height"),n("span",{class:"token interpolation-punctuation punctuation"},"}")]),n("span",{class:"token string"},"px;\\n"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token function"},"callback"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},","),s(" source"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),K=n("h3",{id:"plugin-插件开发",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#plugin-插件开发","aria-hidden":"true"},"#"),s(" plugin 插件开发")],-1),X=n("p",null,"插件没有像 loader 那样的独立运行环境，只能在 webpack 里面运行。",-1),Y=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token comment"},"// plugin.js"),s(`
module`),n("span",{class:"token punctuation"},"."),s("exports "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Plugin"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"compiler"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    compiler`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),s("done"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"tap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Plugin'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"stats"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),s("stats"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token comment"},"// webpack.config.js"),s(`
module`),n("span",{class:"token punctuation"},"."),s("exports "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token literal-property property"},"plugins"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"Plugin"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"]"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),nn=n("h4",{id:"plugin-参数获取",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#plugin-参数获取","aria-hidden":"true"},"#"),s(" plugin 参数获取")],-1),sn=n("p",null,"通过插件的构造函数进行获取。",-1),an=n("h4",{id:"plugin-异常处理",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#plugin-异常处理","aria-hidden":"true"},"#"),s(" plugin 异常处理")],-1),tn=n("li",null,[n("p",null,"参数校验阶段可以直接 throw 的方式抛出")],-1),on=n("p",null,"通过 compilation 对象的 warnings 和 errors 接收",-1),en=n("pre",{class:"language-javascript"},[n("code",null,[s("compilation"),n("span",{class:"token punctuation"},"."),s("warnings"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'warning'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
compilation`),n("span",{class:"token punctuation"},"."),s("errors"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"push"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'error'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),cn=n("h4",{id:"plugin-文件输出",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#plugin-文件输出","aria-hidden":"true"},"#"),s(" plugin 文件输出")],-1),pn=n("p",null,"compilation 上的 assets 可用于文件输出",-1),ln=n("li",null,[n("p",null,[s("可以将 zip 资源包设置到 "),n("code",null,"compilation.assets"),s(" 对象上")])],-1),un={href:"https://github.com/webpack/webpack-sources",target:"_blank",rel:"noopener noreferrer"},rn=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" RawSource "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'webpack-source'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
compiler`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),s("emit"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"tap"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Plugin'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("compilation"),n("span",{class:"token punctuation"},","),s(" cb")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  compilation`),n("span",{class:"token punctuation"},"."),s("assets"),n("span",{class:"token punctuation"},"["),s("name"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"RawSource"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'test'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token function"},"cb"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1),kn=e('<h4 id="插件扩展-插件的插件" tabindex="-1"><a class="header-anchor" href="#插件扩展-插件的插件" aria-hidden="true">#</a> 插件扩展(插件的插件)</h4><p>插件自身也可以通过暴露 hooks 的方式进行自身扩展，如 html-webpack-plugin：</p><ul><li>html-webpack-plugin-alter-chunks (Sync)</li><li>html-webpack-plugin-before-html-generation (Async)</li><li>html-webpack-plugin-alter-asset-tags (Async)</li><li>html-webpack-plugin-after-html-processing (Async)</li><li>html-webpack-plugin-after-emit (Async)</li></ul><h4 id="压缩构建资源位-zip-包插件" tabindex="-1"><a class="header-anchor" href="#压缩构建资源位-zip-包插件" aria-hidden="true">#</a> 压缩构建资源位 zip 包插件</h4>',4),dn=n("li",null,[n("p",null,"生成的 zip 包文件名称可以通过插件传入")],-1),An=n("li",null,[n("p",null,"需要使用 compiler 对象上的特定 hooks 进行资源生成")],-1),gn={href:"https://github.com/Stuk/jszip",target:"_blank",rel:"noopener noreferrer"},mn=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" zip "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"JSZip"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

zip`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"file"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"Hello.txt"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"Hello World\\n"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" img "),n("span",{class:"token operator"},"="),s(" zip"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"folder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"images"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
img`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"file"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"smile.gif"'),n("span",{class:"token punctuation"},","),s(" imgData"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"{"),n("span",{class:"token literal-property property"},"base64"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

zip`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"generateAsync"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),n("span",{class:"token literal-property property"},"type"),n("span",{class:"token operator"},":"),n("span",{class:"token string"},'"blob"'),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"function"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"content"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// see FileSaver.js"),s(`
    `),n("span",{class:"token function"},"saveAs"),n("span",{class:"token punctuation"},"("),s("content"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"example.zip"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},`/*
Results in a zip containing
Hello.txt
images/
    smile.gif
*/`),s(`
`)])],-1),hn=n("li",null,[n("p",null,[s("emit (AsyncSeriesHook) 生成文件阶段， 读取 "),n("code",null,"compilation.assets"),s("对象的值，故 将 zip 资源包设置到 "),n("code",null,"compilation.assets"),s(" 对象上")])],-1),fn=n("p",null,[n("strong",null,"关键处理逻辑")],-1),Bn=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),s(" path "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'path'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(" JSZip "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'jszip'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"const"),s(),n("span",{class:"token punctuation"},"{"),s(" RawSource "),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'webpack-sources'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"const"),s(" zip "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"JSZip"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

module`),n("span",{class:"token punctuation"},"."),s("exports "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ZipPlugin"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token function"},"constructor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"options"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("options "),n("span",{class:"token operator"},"="),s(" options"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"compiler"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    compiler`),n("span",{class:"token punctuation"},"."),s("hooks"),n("span",{class:"token punctuation"},"."),s("emit"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"tapAsync"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'ZipPlugin'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("compilation"),n("span",{class:"token punctuation"},","),s(" callback")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token keyword"},"const"),s(" folder "),n("span",{class:"token operator"},"="),s(" zip"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"folder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("options"),n("span",{class:"token punctuation"},"."),s("filename"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      Object`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"keys"),n("span",{class:"token punctuation"},"("),s("compilation"),n("span",{class:"token punctuation"},"."),s("assets"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"forEach"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"filename"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"const"),s(" source "),n("span",{class:"token operator"},"="),s(" compilation"),n("span",{class:"token punctuation"},"."),s("assets"),n("span",{class:"token punctuation"},"["),s("filename"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"source"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        folder`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"file"),n("span",{class:"token punctuation"},"("),s("filename"),n("span",{class:"token punctuation"},","),s(" source"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

      zip`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"generateAsync"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"type"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'nodebuffer'"),s(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"content"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"const"),s(" outputPath "),n("span",{class:"token operator"},"="),s(" path"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"join"),n("span",{class:"token punctuation"},"("),s("compilation"),n("span",{class:"token punctuation"},"."),s("options"),n("span",{class:"token punctuation"},"."),s("output"),n("span",{class:"token punctuation"},"."),s("path"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("options"),n("span",{class:"token punctuation"},"."),s("filename "),n("span",{class:"token operator"},"+"),s(),n("span",{class:"token string"},"'.zip'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"const"),s(" outputRelativePath "),n("span",{class:"token operator"},"="),s(" path"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"relative"),n("span",{class:"token punctuation"},"("),s(`
          compilation`),n("span",{class:"token punctuation"},"."),s("options"),n("span",{class:"token punctuation"},"."),s("output"),n("span",{class:"token punctuation"},"."),s("path"),n("span",{class:"token punctuation"},","),s(`
          outputPath
        `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        compilation`),n("span",{class:"token punctuation"},"."),s("assets"),n("span",{class:"token punctuation"},"["),s("outputRelativePath"),n("span",{class:"token punctuation"},"]"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"RawSource"),n("span",{class:"token punctuation"},"("),s("content"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token function"},"callback"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`)])],-1);function yn(En,bn){const t=p("CodeTool"),c=p("ExternalLinkIcon");return u(),i("div",null,[g,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"%2F%2F%201.%20%E6%AD%A3%E5%B8%B8%E6%89%A7%E8%A1%8C%E8%BF%94%E5%9B%9E%0Aprocess.exitCode%20%3D%200%3B%0A%2F%2F%202.%20%E8%BF%90%E8%A1%8C%E6%9F%90%E4%B8%AA%E5%91%BD%E4%BB%A4%0Aconst%20runCommand%20%3D%20(command%2C%20args)%20%3D%3E%20%7B%7D%3B%0A%2F%2F%203.%20%E5%88%A4%E6%96%AD%E6%9F%90%E4%B8%AA%E5%8C%85%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%0Aconst%20isInstalled%20%3D%20packageName%20%3D%20%7B%7D%3B%0A%2F%2F%204.%20webpack%E5%8F%AF%E7%94%A8%E7%9A%84CLI%EF%BC%9Awebpack-cli%E5%92%8Cwebpack-command%0Aconst%20CLIs%20%3D%20%5B%5D%3B%0A%2F%2F%205.%20%E8%BF%87%E6%BB%A4%E5%AE%89%E8%A3%85%E8%BF%87%E7%9A%84CLI%0Aconst%20installedClis%20%3D%20CLIs.filter(cli%20%3D%3E%20cli.installed)%3B%0A%2F%2F%206.%20%E6%A0%B9%E6%8D%AE%E5%AE%89%E8%A3%85%E6%95%B0%E9%87%8F%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%0Aif%20(installedClis.length%20%3D%3D%3D%200)%20%7B%0A%7D%20else%20if%20(installedClis.length%20%3D%3D%3D%201)%20%7B%0A%7D%20else%20%7B%7D%0A%2F%2F%207.%20%E4%B8%AD%E9%80%94%E6%8A%A5%E9%94%99%E9%80%80%E5%87%BA%0Aprocess.exitCode%20%3D%201%3B%0A",ext:"javascript"},{default:o(()=>[m]),_:1}),h,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"%2F*%20const%20NON_COMPILATION_ARGS%20%3D%20%5B%0A%09%22init%22%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%BB%BD%20webpack%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%0A%09%22migrate%22%2C%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%BF%9B%E8%A1%8Cwebpack%E7%89%88%E6%9C%AC%E8%BF%81%E7%A7%BB%0A%09%22add%22%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%90%91webpack%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%A2%9E%E5%8A%A0%E5%B1%9E%E6%80%A7%0A%09%22remove%22%2C%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%90%91webpack%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%88%A0%E9%99%A4%E5%B1%9E%E6%80%A7%0A%09%22serve%22%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%BF%90%E8%A1%8Cwebpack-serve%0A%09%22generate-loader%22%2C%20%20%20%2F%2F%20%E7%94%9F%E6%88%90webpack-loader%E4%BB%A3%E7%A0%81%0A%09%22generate-plugin%22%2C%20%20%20%2F%2F%20%E7%94%9F%E6%88%90webpack-plugin%E4%BB%A3%E7%A0%81%0A%09%22info%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%E4%B8%8E%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BF%A1%E6%81%AF%0A%5D%3B%20*%2F%0Aconst%20%7B%20NON_COMPILATION_ARGS%20%7D%20%3D%20require(%22.%2Futils%2Fconstants%22)%3B%0A%0Aconst%20NON_COMPILATION_CMD%20%3D%20process.argv.find(arg%20%3D%3E%20%7B%0A%20%20if%20(arg%20%3D%3D%3D%20%22serve%22)%20%7B%0A%20%20%20%20global.process.argv%20%3D%20global.process.argv.filter(a%20%3D%3E%20a%20!%3D%3D%20%22serve%22)%3B%0A%20%20%20%20process.argv%20%3D%20global.process.argv%3B%0A%20%20%7D%0A%20%20return%20NON_COMPILATION_ARGS.find(a%20%3D%3E%20a%20%3D%3D%3D%20arg)%3B%0A%7D)%3B%0A%0Aif%20(NON_COMPILATION_CMD)%20%7B%0A%20%20return%20require(%22.%2Futils%2Fprompt-command%22)(NON_COMPILATION_CMD%2C%20...process.argv)%3B%0A%7D%0A%0A",ext:"javascript"},{default:o(()=>[f]),_:1}),B,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20%7B%0A%20%20SyncHook%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%90%8C%E6%AD%A5%E9%92%A9%E5%AD%90%0A%20%20SyncBailHook%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%90%8C%E6%AD%A5%E7%86%94%E6%96%AD%E9%92%A9%E5%AD%90%0A%20%20SyncWaterfallHook%2C%20%20%20%20%20%20%20%20%2F%2F%20%E5%90%8C%E6%AD%A5%E6%B5%81%E6%B0%B4%E9%92%A9%E5%AD%90%0A%20%20SyncLoopHook%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%90%8C%E6%AD%A5%E5%BE%AA%E7%8E%AF%E9%92%A9%E5%AD%90%0A%20%20AsyncParallelHook%2C%20%20%20%20%20%20%20%20%2F%2F%20%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91%E9%92%A9%E5%AD%90%0A%20%20AsyncParallelBailHook%2C%20%20%20%20%2F%2F%20%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91%E7%86%94%E6%96%AD%E9%92%A9%E5%AD%90%0A%20%20AsyncSeriesHook%2C%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BC%82%E6%AD%A5%E4%B8%B2%E8%A1%8C%E9%92%A9%E5%AD%90%0A%20%20AsyncSeriesBailHook%2C%20%20%20%20%20%20%2F%2F%20%E5%BC%82%E6%AD%A5%E4%B8%B2%E8%A1%8C%E7%86%94%E6%96%AD%E9%92%A9%E5%AD%90%0A%20%20AsyncSeriesWaterfallHook%20%20%2F%2F%20%E5%BC%82%E6%AD%A5%E4%B8%B2%E8%A1%8C%E6%B5%81%E6%B0%B4%E9%92%A9%E5%AD%90%0A%7D%20%3D%20require('tapable')%3B%0A",ext:"javascript"},{default:o(()=>[y]),_:1}),E,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20hook1%20%3D%20new%20SyncHook(%5B'arg1'%2C%20'arg2'%2C%20'arg3'%5D)%3B%0A%0A%2F%2F%20%E7%BB%91%E5%AE%9A%E5%AE%9E%E8%B7%B5%E5%88%B0%20webpack%20%E4%BA%8B%E4%BB%B6%E6%B5%81%0Ahook1.tap('hook1'%2C%20(arg1%2C%20arg2%2C%20arg3)%20%3D%3E%20console.log(arg1%2C%20arg2%2C%20arg3))%3B%0A%0A%2F%2F%20%E6%89%A7%E8%A1%8C%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6%0Ahook1.call(1%2C%202%2C%203)%3B%0A",ext:"javascript"},{default:o(()=>[b]),_:1}),w,D,C,_,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20%7B%20SyncHook%2C%20AsyncSeriesHook%20%7D%20%3D%20require('tapable')%3B%0A%0Aclass%20Car%20%7B%0A%20%20constructor()%20%7B%0A%20%20%20%20this.hooks%20%3D%20%7B%0A%20%20%20%20%20%20accelerate%3A%20new%20SyncHook(%5B'newspeed'%5D)%2C%0A%20%20%20%20%20%20brake%3A%20new%20SyncHook()%2C%0A%20%20%20%20%20%20calculateRoutes%3A%20new%20AsyncSeriesHook(%5B'source'%2C%20'target'%2C%20'routesList'%5D)%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%7D%0A%0Aconst%20myCar%20%3D%20new%20Car()%3B%0A%0AmyCar.hooks.brake.tap('WarningLampPlugin'%2C%20()%20%3D%3E%20console.log('WarningLampPlugin'))%3B%0A%0AmyCar.hooks.accelerate.tap('LoggerPlugin'%2C%20newSpeed%20%3D%3E%20console.log(%60Accelerating%20to%20%24%7BnewSpeed%7D%60))%3B%0A%0AmyCar.hooks.calculateRoutes.tapPromise('calcuateRoutes%20tapPromise'%2C%20(source%2C%20target%2C%20routesList%2C%20callback)%20%3D%3E%20%7B%0A%20%20console.log('source'%2C%20source)%3B%0A%20%20return%20new%20Promise((resolve%2C%20reject)%20%3D%3E%20%7B%0A%20%20%20%20setTimeout(()%20%3D%3E%20%7B%0A%20%20%20%20%20%20console.log(%60tapPromise%20to%20%24%7Bsource%7D%24%7Btarget%7D%24%7BroutesList%7D%60)%3B%0A%20%20%20%20%20%20resolve()%3B%0A%20%20%20%20%7D%2C%201000)%3B%0A%20%20%7D)%3B%0A%7D)%3B%0A%0AmyCar.hooks.brake.call()%3B%0AmyCar.hooks.accelerate.call(10)%3B%0A%0Aconsole.time('cost')%3B%0A%0AmyCar.hooks.calculateRoutes.promise('Async'%2C%20'Hook'%2C%20'Demo').then(()%20%3D%3E%20%7B%0A%20%20console.timeEnd('cost')%3B%0A%7D%2C%20err%20%3D%3E%20%7B%0A%20%20console.error(err)%3B%0A%20%20console.timeEnd('cost')%3B%0A%7D)%3B%0A",ext:"javascript"},{default:o(()=>[F]),_:1}),x,v,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"let%20compiler%3B%0Aif%20(Array.isArray(options))%20%7B%0A%20%20compiler%20%3D%20new%20MultiCompiler(%0A%20%20%20%20Array.from(options).map(options%20%3D%3E%20webpack(options))%0A%20%20)%3B%0A%7D%20else%20if%20(typeof%20options%20%3D%3D%3D%20%22object%22)%20%7B%0A%20%20options%20%3D%20new%20WebpackOptionsDefaulter().process(options)%3B%0A%0A%20%20compiler%20%3D%20new%20Compiler(options.context)%3B%0A%20%20compiler.options%20%3D%20options%3B%0A%20%20new%20NodeEnvironmentPlugin(%7B%0A%20%20%20%20infrastructureLogging%3A%20options.infrastructureLogging%0A%20%20%7D).apply(compiler)%3B%0A%20%20if%20(options.plugins%20%26%26%20Array.isArray(options.plugins))%20%7B%0A%20%20%20%20for%20(const%20plugin%20of%20options.plugins)%20%7B%0A%20%20%20%20%20%20if%20(typeof%20plugin%20%3D%3D%3D%20%22function%22)%20%7B%0A%20%20%20%20%20%20%20%20plugin.call(compiler%2C%20compiler)%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20plugin.apply(compiler)%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20compiler.hooks.environment.call()%3B%0A%20%20compiler.hooks.afterEnvironment.call()%3B%0A%20%20compiler.options%20%3D%20new%20WebpackOptionsApply().process(options%2C%20compiler)%3B%0A%7D%20else%20%7B%0A%20%20throw%20new%20Error(%22Invalid%20argument%3A%20options%22)%3B%0A%7D%0A",ext:"javascript"},{default:o(()=>[j]),_:1}),S,n("p",null,[s("AST(Abstract syntax tree) 抽象语法树，是源代码的抽象语法结构的树状表现形式，树上的每个节点都表示源代码中的一种结构。例如 "),n("a",P,[s("esprima"),a(c)])]),N,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"module.exports%20%3D%20%7B%0A%20%20module%3A%20%7B%0A%20%20%20%20rules%3A%20%5B%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20test%3A%20%2F%5C.less%24%2F%2C%0A%20%20%20%20%20%20%20%20use%3A%20%5B'style-loader'%2C%20'css-loader'%2C%20'less-loader'%5D%0A%20%20%20%20%20%20%20%20%2F%2F%20%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%3A%203%20%3C-%202%20%3C-%201%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%5D%0A%20%20%7D%0A%7D%3B%0A",ext:"javascript"},{default:o(()=>[H]),_:1}),L,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"import%20%7B%20runLoaders%20%7D%20from%20'loader-runner'%3B%0A%0ArunLoaders(%7B%0A%20%20%2F%2F%20String%20%E8%B5%84%E6%BA%90%E7%9A%84%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%A2%9E%E5%8A%A0%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89%0A%20%20resource%3A%20'%2Fabs%2Fpath%2Fto%2Ffile.txt%3Fquery'%2C%0A%20%20%2F%2F%20String%5B%5D%20loader%E7%9A%84%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%A2%9E%E5%8A%A0%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89%0A%20%20loaders%3A%20'%2Fabs%2Fpath%2Fto%2Floader.js%3Fquery'%2C%0A%20%20%2F%2F%20%E5%9F%BA%E7%A1%80%E4%B8%8A%E4%B8%8B%E6%96%87%E4%B9%8B%E5%A4%96%E7%9A%84%E9%A2%9D%E5%A4%96loader%E4%B8%8A%E4%B8%8B%E6%96%87%0A%20%20context%3A%20%7B%20minimize%3A%20true%20%7D%2C%0A%20%20%2F%2F%20%E8%AF%BB%E5%8F%96%E8%B5%84%E6%BA%90%E7%9A%84%E5%87%BD%E6%95%B0%0A%20%20readResource%3A%20fs.readFile.bind(fs)%2C%0A%7D%2C%20function(err%2C%20result)%20%7B%0A%20%20%2F%2F%20err%3A%20Error%3F%0A%20%20%2F%2F%20result.result%3A%20Buffer%20%7C%20String%0A%7D)%3B%0A",ext:"javascript"},{default:o(()=>[O]),_:1}),I,z,M,n("ul",null,[R,n("li",null,[T,n("ul",null,[n("li",null,[a(t,{class:"language-typescript","data-ext":"ts",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"this.callback(%0A%20%20err%3A%20Error%20%7C%20null%2C%0A%20%20content%3A%20string%20%7C%20Buffer%2C%0A%20%20sourceMap%3F%3A%20SourceMap%2C%0A%20%20meta%3F%3A%20any%0A)%3B%0A",ext:"typescript"},{default:o(()=>[q]),_:1})])])])]),W,J,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20callback%20%3D%20this.async()%3B%0A%0Aif%20(callback)%20%7B%0A%20%20%2F%2F%20...%0A%7D%0Acallback(null%2C%20result)%0A",ext:"javascript"},{default:o(()=>[$]),_:1}),Z,n("p",null,[n("strong",null,[s("使用"),n("a",G,[s("spritesmith"),a(c)]),s("将多张图片合成为一张图片")])]),V,Q,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20fs%20%3D%20require('fs')%3B%0Aconst%20path%20%3D%20require('path')%3B%0Aconst%20Spritesmith%20%3D%20require('spritesmith')%3B%0A%0Amodule.exports%20%3D%20function%20(source)%20%7B%0A%20%20const%20callback%20%3D%20this.async()%3B%0A%20%20const%20imgs%20%3D%20source.match(%2Furl%5C((%5CS*)%5C%3F__sprite%2Fg)%3B%0A%20%20const%20matchedImgs%20%3D%20%5B%5D%3B%0A%0A%20%20for%20(let%20i%20%3D%200%3B%20i%20%3C%20imgs.length%3B%20i%20%2B%3D%201)%20%7B%0A%20%20%20%20const%20img%20%3D%20imgs%5Bi%5D.match(%2Furl%5C((%5CS*)%5C%3F__sprite%2F)%5B1%5D%3B%0A%20%20%20%20matchedImgs.push(path.join(__dirname%2C%20img))%3B%0A%20%20%7D%0A%0A%20%20Spritesmith.run(%7B%20src%3A%20matchedImgs%20%7D%2C%20(err%2C%20result)%20%3D%3E%20%7B%0A%20%20%20%20fs.writeFileSync(path.join(process.cwd()%2C%20'dist%2Fsprite.jpg')%2C%20result.image)%3B%0A%20%20%20%20console.log(result.coordinates%2C%20result.properties)%3B%0A%20%20%20%20source%20%3D%20source.replace(%2Furl%5C((%5CS*)%5C%3F__sprite%5C)%2Fg%2C%20(match%2C%20%240)%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20filePath%20%3D%20path.join(__dirname%2C%20%240)%3B%0A%20%20%20%20%20%20const%20%7B%20x%2C%20y%2C%20width%2C%20height%20%7D%20%3D%20result.coordinates%5BfilePath%5D%3B%0A%20%20%20%20%20%20return%20%60url(%22dist%2Fsprite.jpg%22)%3B%5Cn%20%20background-position%3A%20%24%7Bx%7Dpx%20%24%7By%7Dpx%3B%5Cn%20%20background-size%3A%20%24%7Bwidth%7Dpx%20%24%7Bheight%7Dpx%3B%5Cn%60%3B%0A%20%20%20%20%7D)%3B%0A%20%20%20%20callback(null%2C%20source)%3B%0A%20%20%7D)%3B%0A%7D%3B%0A",ext:"javascript"},{default:o(()=>[U]),_:1}),K,X,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"%2F%2F%20plugin.js%0Amodule.exports%20%3D%20class%20Plugin%20%7B%0A%20%20apply(compiler)%20%7B%0A%20%20%20%20compiler.hooks.done.tap('Plugin'%2C%20(stats)%20%3D%3E%20%7B%0A%20%20%20%20%20%20console.log(stats)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%0A%2F%2F%20webpack.config.js%0Amodule.exports%20%3D%20%7B%0A%20%20plugins%3A%20%5Bnew%20Plugin()%5D%0A%7D%3B%0A",ext:"javascript"},{default:o(()=>[Y]),_:1}),nn,sn,an,n("ul",null,[tn,n("li",null,[on,n("ul",null,[n("li",null,[a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"compilation.warnings.push('warning')%3B%0Acompilation.errors.push('error')%3B%0A",ext:"javascript"},{default:o(()=>[en]),_:1})])])])]),cn,pn,n("ul",null,[ln,n("li",null,[n("p",null,[s("需要使用 "),n("a",un,[s("webpack-source"),a(c)])]),n("ul",null,[n("li",null,[a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20%7B%20RawSource%20%7D%20%3D%20require('webpack-source')%3B%0Acompiler.hooks.emit.tap('Plugin'%2C%20(compilation%2C%20cb)%20%3D%3E%20%7B%0A%20%20compilation.assets%5Bname%5D%20%3D%20new%20RawSource('test')%3B%0A%20%20cb()%3B%0A%7D)%3B%0A",ext:"javascript"},{default:o(()=>[rn]),_:1})])])])]),kn,n("ul",null,[dn,An,n("li",null,[n("p",null,[s("使用 "),n("a",gn,[s("jszip"),a(c)]),s(" 压缩 zip 包")]),n("ul",null,[n("li",null,[a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20zip%20%3D%20new%20JSZip()%3B%0A%0Azip.file(%22Hello.txt%22%2C%20%22Hello%20World%5Cn%22)%3B%0A%0Aconst%20img%20%3D%20zip.folder(%22images%22)%3B%0Aimg.file(%22smile.gif%22%2C%20imgData%2C%20%7Bbase64%3A%20true%7D)%3B%0A%0Azip.generateAsync(%7Btype%3A%22blob%22%7D).then(function(content)%20%7B%0A%20%20%20%20%2F%2F%20see%20FileSaver.js%0A%20%20%20%20saveAs(content%2C%20%22example.zip%22)%3B%0A%7D)%3B%0A%0A%2F*%0AResults%20in%20a%20zip%20containing%0AHello.txt%0Aimages%2F%0A%20%20%20%20smile.gif%0A*%2F%0A",ext:"javascript"},{default:o(()=>[mn]),_:1})])])]),hn]),fn,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20path%20%3D%20require('path')%3B%0Aconst%20JSZip%20%3D%20require('jszip')%3B%0Aconst%20%7B%20RawSource%20%7D%20%3D%20require('webpack-sources')%3B%0A%0Aconst%20zip%20%3D%20new%20JSZip()%3B%0A%0Amodule.exports%20%3D%20class%20ZipPlugin%20%7B%0A%20%20constructor(options)%20%7B%0A%20%20%20%20this.options%20%3D%20options%3B%0A%20%20%7D%0A%0A%20%20apply(compiler)%20%7B%0A%20%20%20%20compiler.hooks.emit.tapAsync('ZipPlugin'%2C%20(compilation%2C%20callback)%20%3D%3E%20%7B%0A%20%20%20%20%20%20const%20folder%20%3D%20zip.folder(this.options.filename)%3B%0A%20%20%20%20%20%20Object.keys(compilation.assets).forEach(filename%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20const%20source%20%3D%20compilation.assets%5Bfilename%5D.source()%3B%0A%20%20%20%20%20%20%20%20folder.file(filename%2C%20source)%3B%0A%20%20%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%20%20zip.generateAsync(%7B%20type%3A%20'nodebuffer'%20%7D).then(content%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20const%20outputPath%20%3D%20path.join(compilation.options.output.path%2C%20this.options.filename%20%2B%20'.zip')%3B%0A%20%20%20%20%20%20%20%20const%20outputRelativePath%20%3D%20path.relative(%0A%20%20%20%20%20%20%20%20%20%20compilation.options.output.path%2C%0A%20%20%20%20%20%20%20%20%20%20outputPath%0A%20%20%20%20%20%20%20%20)%3B%0A%20%20%20%20%20%20%20%20compilation.assets%5BoutputRelativePath%5D%20%3D%20new%20RawSource(content)%3B%0A%0A%20%20%20%20%20%20%20%20callback()%3B%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%3B%0A",ext:"javascript"},{default:o(()=>[Bn]),_:1})])}const Dn=l(A,[["render",yn],["__file","sourcecode.html.vue"]]);export{Dn as default};
