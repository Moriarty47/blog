import{_ as c,M as p,p as l,q as r,N as a,V as s,a0 as o,Q as n,t as e}from"./framework-5411b43d.js";const i="/blog/assets/webpackHMR-57a79cd4.png",u={},d=o('<h2 id="webpack-文件监听" tabindex="-1"><a class="header-anchor" href="#webpack-文件监听" aria-hidden="true">#</a> Webpack 文件监听</h2><p>文件监听： 在监听到源码发生变化时，自动重新构建出新的输出文件。</p><p>webpack 开启监听模式的两种方式：</p><ul><li><code>webpack --watch</code></li><li><code>webpack.config.js</code> 配置文件中设置 <code>watch: true</code></li></ul><div class="custom-container warning"><p class="custom-container-title">注意</p><p>缺点是：每次编译完成需要手动刷新浏览器</p></div><h3 id="原理" tabindex="-1"><a class="header-anchor" href="#原理" aria-hidden="true">#</a> 原理</h3><p>轮询判断文件的最后编辑时间是否发生变化，当某个文件发生变化，并不会立刻告诉监听者，而是先缓存起来，等待 aggregateTimeout，等待时间内有其他文件发生变化，则继续将其加入变化列表最后在等待时间结束后统一触发。</p>',7),k=n("pre",{class:"language-javascript"},[n("code",null,[e("module"),n("span",{class:"token punctuation"},"."),e("exports "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token punctuation"},"{"),e(`
  `),n("span",{class:"token comment"},"// ..."),e(`
  `),n("span",{class:"token literal-property property"},"watch"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token comment"},"// 默认 false，即不开启"),e(`
  `),n("span",{class:"token literal-property property"},"watchOptions"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token punctuation"},"{"),e(),n("span",{class:"token comment"},"// 只有开启监听模式时，配置才生效"),e(`
    `),n("span",{class:"token comment"},"// 默认为空，忽略监听文件或文件夹，支持正则匹配"),e(`
    `),n("span",{class:"token literal-property property"},"ignored"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token regex"},[n("span",{class:"token regex-delimiter"},"/"),n("span",{class:"token regex-source language-regex"},"node_modules"),n("span",{class:"token regex-delimiter"},"/")]),n("span",{class:"token punctuation"},","),e(`
    `),n("span",{class:"token comment"},"// 监听到变化发生后会等 300ms 再去执行，默认 300ms"),e(`
    `),n("span",{class:"token literal-property property"},"aggregateTimeout"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token number"},"300"),n("span",{class:"token punctuation"},","),e(`
    `),n("span",{class:"token comment"},"// 判断文件是否发生变化是通过不停轮询系统指定文件有无变化实现的，默认 每秒询问1000次"),e(`
    `),n("span",{class:"token literal-property property"},"poll"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token number"},"1000"),e(`
  `),n("span",{class:"token punctuation"},"}"),e(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),e(`
`)])],-1),E=o('<h2 id="webpack-热更新" tabindex="-1"><a class="header-anchor" href="#webpack-热更新" aria-hidden="true">#</a> Webpack 热更新</h2><h3 id="原理-1" tabindex="-1"><a class="header-anchor" href="#原理-1" aria-hidden="true">#</a> 原理</h3><table-center><table><thead><tr><th style="text-align:left;"></th><th style="text-align:left;">功能</th></tr></thead><tbody><tr><td style="text-align:left;">Webpack Compile</td><td style="text-align:left;">将 JS 编译成 Bundle</td></tr><tr><td style="text-align:left;">HMR Server</td><td style="text-align:left;">将热更新的文件输出给 HMR Runtime</td></tr><tr><td style="text-align:left;">Bundle Server</td><td style="text-align:left;">提供文件在浏览器的访问</td></tr><tr><td style="text-align:left;">HMR Runtime</td><td style="text-align:left;">会被注入到浏览器，更新文件的变化</td></tr><tr><td style="text-align:left;">bundle.js</td><td style="text-align:left;">构建输出的文件</td></tr></tbody></table></table-center><center><p><img src="'+i+'" alt="webpack-hmr"></p></center><h3 id="webpack-dev-server" tabindex="-1"><a class="header-anchor" href="#webpack-dev-server" aria-hidden="true">#</a> webpack-dev-server</h3><p>WDS 无需手动刷新浏览器，不输出文件，而是放在内存中。无磁盘 IO 问题，构建速度更快。</p><p>配合 HotModuleReplacementPlugin 插件</p><p>webpack-dev-server(WDS)的功能提供 bundle server 的能力，就是生成的 bundle.js 文件可以通过 localhost://xxx 的方式去访问，另外 WDS 也提供 livereload(浏览器的自动刷新)。</p><p>HotModuleReplacementPlugin 的作用是提供 HMR 的 runtime，并且将 runtime 注入到 bundle.js 代码里面去。一旦磁盘里面的文件修改，那么 HMR server 会将有修改的 js module 信息发送给 HMR runtime，然后 HMR runtime 去局部更新页面的代码。因此这种方式可以不用刷新浏览器。</p><p>单独写两个包也是出于功能的解耦来考虑的。简单来说就是：HotModuleReplacementPlugin 包给 webpack-dev-server 提供了热更新的能力。</p><h3 id="webpack-dev-middleware" tabindex="-1"><a class="header-anchor" href="#webpack-dev-middleware" aria-hidden="true">#</a> webpack-dev-middleware</h3><p>WDM 将 webpack 输出的文件传输给服务器，适用于灵活的定制场景</p>',12),A=n("pre",{class:"language-javascript"},[n("code",null,[n("span",{class:"token keyword"},"const"),e(" express "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'express'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`
`),n("span",{class:"token keyword"},"const"),e(" webpack "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'webpack'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`
`),n("span",{class:"token keyword"},"const"),e(" webpackDevMiddleware "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token function"},"requrie"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'webpack-dev-middleware'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`

`),n("span",{class:"token keyword"},"const"),e(" app "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token function"},"express"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`
`),n("span",{class:"token keyword"},"const"),e(" config "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token function"},"require"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'./webpack.config.js'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`
`),n("span",{class:"token keyword"},"const"),e(" compiler "),n("span",{class:"token operator"},"="),e(),n("span",{class:"token function"},"webpack"),n("span",{class:"token punctuation"},"("),e("config"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`

app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"use"),n("span",{class:"token punctuation"},"("),n("span",{class:"token function"},"webpackDevMiddleware"),n("span",{class:"token punctuation"},"("),e("compiler"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token punctuation"},"{"),e(`
  `),n("span",{class:"token literal-property property"},"publicPath"),n("span",{class:"token operator"},":"),e(" config"),n("span",{class:"token punctuation"},"."),e("output"),n("span",{class:"token punctuation"},"."),e("publicPath"),n("span",{class:"token punctuation"},","),e(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`

app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"listen"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"3000"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token keyword"},"function"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),e(),n("span",{class:"token punctuation"},"{"),e(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'App is running at http://localhost:3000\\n'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),e(`
`),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token template-punctuation string"},"`")]),e(`
`)])],-1);function B(h,g){const t=p("CodeTool");return l(),r("div",null,[d,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"module.exports%20%3D%20%7B%0A%20%20%2F%2F%20...%0A%20%20watch%3A%20true%2C%20%2F%2F%20%E9%BB%98%E8%AE%A4%20false%EF%BC%8C%E5%8D%B3%E4%B8%8D%E5%BC%80%E5%90%AF%0A%20%20watchOptions%3A%20%7B%20%2F%2F%20%E5%8F%AA%E6%9C%89%E5%BC%80%E5%90%AF%E7%9B%91%E5%90%AC%E6%A8%A1%E5%BC%8F%E6%97%B6%EF%BC%8C%E9%85%8D%E7%BD%AE%E6%89%8D%E7%94%9F%E6%95%88%0A%20%20%20%20%2F%2F%20%E9%BB%98%E8%AE%A4%E4%B8%BA%E7%A9%BA%EF%BC%8C%E5%BF%BD%E7%95%A5%E7%9B%91%E5%90%AC%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%8C%E6%94%AF%E6%8C%81%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%0A%20%20%20%20ignored%3A%20%2Fnode_modules%2F%2C%0A%20%20%20%20%2F%2F%20%E7%9B%91%E5%90%AC%E5%88%B0%E5%8F%98%E5%8C%96%E5%8F%91%E7%94%9F%E5%90%8E%E4%BC%9A%E7%AD%89%20300ms%20%E5%86%8D%E5%8E%BB%E6%89%A7%E8%A1%8C%EF%BC%8C%E9%BB%98%E8%AE%A4%20300ms%0A%20%20%20%20aggregateTimeout%3A%20300%2C%0A%20%20%20%20%2F%2F%20%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%E6%98%AF%E9%80%9A%E8%BF%87%E4%B8%8D%E5%81%9C%E8%BD%AE%E8%AF%A2%E7%B3%BB%E7%BB%9F%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E6%9C%89%E6%97%A0%E5%8F%98%E5%8C%96%E5%AE%9E%E7%8E%B0%E7%9A%84%EF%BC%8C%E9%BB%98%E8%AE%A4%20%E6%AF%8F%E7%A7%92%E8%AF%A2%E9%97%AE1000%E6%AC%A1%0A%20%20%20%20poll%3A%201000%0A%20%20%7D%0A%7D%3B%0A",ext:"javascript"},{default:s(()=>[k]),_:1}),E,a(t,{class:"language-javascript","data-ext":"js",fullscreen:"undefined",steps:"undefined",action:"undefined",winCtrl:"false",async:"undefined",content:"const%20express%20%3D%20require('express')%3B%0Aconst%20webpack%20%3D%20require('webpack')%3B%0Aconst%20webpackDevMiddleware%20%3D%20requrie('webpack-dev-middleware')%3B%0A%0Aconst%20app%20%3D%20express()%3B%0Aconst%20config%20%3D%20require('.%2Fwebpack.config.js')%3B%0Aconst%20compiler%20%3D%20webpack(config)%3B%0A%0Aapp.use(webpackDevMiddleware(compiler%2C%20%7B%0A%20%20publicPath%3A%20config.output.publicPath%2C%0A%7D))%3B%0A%0Aapp.listen(3000%2C%20function()%20%7B%0A%20%20console.log('App%20is%20running%20at%20http%3A%2F%2Flocalhost%3A3000%5Cn')%3B%0A%7D)%3B%0A%60%60%0A",ext:"javascript"},{default:s(()=>[A]),_:1})])}const f=c(u,[["render",B],["__file","watch.html.vue"]]);export{f as default};
